<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Emissão de RID</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        /* Estilos personalizados para barra de rolagem */
        .overflow-x-auto::-webkit-scrollbar {
            height: 12px;
        }
        
        .overflow-x-auto::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 6px;
        }
        
        .overflow-x-auto::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 6px;
            border: 2px solid #f1f5f9;
        }
        
        .overflow-x-auto::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Estilo para dropdown de anos */
        #topEmployeesYearFilter {
            transition: all 0.3s ease;
        }
        
        #topEmployeesYearFilter option {
            padding: 8px 12px;
            background: white;
            color: #374151;
        }
        
        #topEmployeesYearFilter option:hover {
            background: #F3F4F6;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Tela de Login Única -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md fade-in">
            <div class="text-center mb-4">
                <div class="flex items-center justify-center mx-auto mb-4">
                    <img src="https://www.jdemito.com.br/wp-content/themes/jdemito/img/logo.png" alt="Logo" class="w-36 h-36 object-contain" onerror="this.style.display='none';">
                </div>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">Sistema RID</h1>
                <p class="text-gray-600">Faça seu login para continuar</p>
            </div>
            
            <form onsubmit="universalLogin(event)" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">CPF</label>
                    <input type="text" id="loginCpf" placeholder="000.000.000-00" class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                    <input type="password" id="loginPassword" class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm" required>
                </div>
                <div id="loginError" class="hidden text-red-600 text-sm text-center"></div>
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-200 transform hover:scale-105 text-base">
                    Entrar
                </button>
                <div class="text-center">
                    <button type="button" onclick="showEmployeeRegister()" class="text-blue-600 hover:text-blue-800 font-medium transition duration-200">
                        Não tem conta? Cadastre-se aqui
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Cadastro Funcionário -->
    <div id="employeeRegisterScreen" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-4 w-full max-w-sm fade-in">
            <div class="text-center mb-6">
                <div class="flex items-center justify-center mx-auto mb-4">
                    <img src="https://www.jdemito.com.br/wp-content/themes/jdemito/img/logo.png" alt="Logo" class="w-36 h-36 object-contain" onerror="this.style.display='none';">
                </div>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Cadastro de Funcionário</h2>
            </div>
            
            <form onsubmit="employeeRegister(event)" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nome Completo</label>
                    <input type="text" id="empRegName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">CPF</label>
                    <input type="text" id="empRegCpf" placeholder="000.000.000-00" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Setor</label>
                    <select id="empRegSector" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                        <option value="">Selecione o setor</option>
                        <option value="ADM">ADM</option>
                        <option value="M. MOVEL">M. MOVEL</option>
                        <option value="M. FIXA">M. FIXA</option>
                        <option value="M. ELÉTRICA">M. ELÉTRICA</option>
                        <option value="PRODUÇÃO">PRODUÇÃO</option>
                        <option value="MINA">MINA</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                    <input type="password" id="empRegPassword" placeholder="Digite sua senha" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                </div>
                <div id="empRegError" class="hidden text-red-600 text-sm text-center"></div>
                <div id="empRegSuccess" class="hidden text-blue-600 text-sm text-center"></div>
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200">
                    Cadastrar
                </button>
                <button type="button" onclick="showLogin()" class="w-full text-gray-600 hover:text-gray-800 font-medium py-2 transition duration-200">
                    ← Voltar ao Login
                </button>
            </form>
        </div>
    </div>

    <!-- Dashboard Administrativo -->
    <div id="adminDashboard" class="hidden min-h-screen bg-gray-50">
        <!-- Cabeçalho -->
        <header class="bg-gray-100 shadow-sm border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 py-0 flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <img src="https://www.jdemito.com.br/wp-content/themes/jdemito/img/logo.png" alt="Logo" class="w-20 h-20 object-contain" onerror="this.style.display='none';">
                    <div>
                        <h1 class="text-2xl font-bold" style="color: #1E293B;">Sistema RID - ADM</h1>
                        <p class="text-sm text-gray-600" id="adminWelcome">Bem-vindo!</p>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <button onclick="showCreateRidModal()" class="h-10 text-white px-5 py-2 rounded-lg font-medium transition duration-200 text-sm" style="background-color: #16A34A;">
                        Criar Novo RID
                    </button>
                    <button onclick="toggleAdminMenu()" class="h-10 w-10 bg-gray-600 hover:bg-gray-700 rounded-lg flex items-center justify-center transition duration-200 relative">
                        <div class="flex flex-col space-y-0.5">
                            <div class="w-4 h-0.5 bg-white"></div>
                            <div class="w-4 h-0.5 bg-white"></div>
                            <div class="w-4 h-0.5 bg-white"></div>
                        </div>
                    </button>
                </div>
            </div>
        </header>

        <!-- Menu Dropdown Admin -->
        <div id="adminDropdownMenu" class="hidden absolute top-16 right-6 bg-white rounded-lg shadow-lg border border-gray-200 z-50 min-w-48">
            <div class="py-2">
                <button onclick="logout()" class="w-full text-left px-4 py-2 text-gray-700 hover:bg-gray-100 flex items-center space-x-2 transition duration-200">
                    <svg class="w-4 h-4 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                    </svg>
                    <span>Sair do Sistema</span>
                </button>
            </div>
        </div>
        
        <div class="max-w-7xl mx-auto p-6">
            <!-- Painel de Métricas -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-100">
                    <div class="flex items-center">
                        <div class="w-12 h-12 rounded-lg flex items-center justify-center" style="background-color: #E0F2FE;">
                            <svg class="w-6 h-6" style="color: #0284C7;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-gray-600">Total de RIDs</p>
                            <p class="text-2xl font-bold text-gray-900" id="totalRids">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-100">
                    <div class="flex items-center">
                        <div class="w-12 h-12 rounded-lg flex items-center justify-center" style="background-color: #FEF3C7;">
                            <svg class="w-6 h-6" style="color: #D97706;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-gray-600">Pendentes</p>
                            <p class="text-2xl font-bold text-gray-900" id="pendingRids">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-100">
                    <div class="flex items-center">
                        <div class="w-12 h-12 rounded-lg flex items-center justify-center" style="background-color: #DCFCE7;">
                            <svg class="w-6 h-6" style="color: #16A34A;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-gray-600">Resolvidos</p>
                            <p class="text-2xl font-bold text-gray-900" id="resolvedRids">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-100">
                    <div class="flex items-center">
                        <div class="w-12 h-12 rounded-lg flex items-center justify-center" style="background-color: #F3E8FF;">
                            <svg class="w-6 h-6" style="color: #9333EA;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-gray-600">RIDs do Mês</p>
                            <p class="text-2xl font-bold text-gray-900" id="monthRids">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Seção Top 3 Funcionários -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-100 p-6 mb-8">
                <div class="mb-6">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 rounded-lg flex items-center justify-center" style="background-color: #FED7AA;">
                                <svg class="w-5 h-5" style="color: #EA580C;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                </svg>
                            </div>
                            <h2 class="text-lg font-bold text-gray-900">Top 3 Funcionários com Mais RIDs</h2>
                            <button onclick="toggleTopEmployeesFilters()" class="w-8 h-8 bg-gray-100 hover:bg-gray-200 border border-gray-300 rounded-lg flex items-center justify-center transition duration-200" title="Mostrar/Ocultar Filtros">
                                <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.707A1 1 0 013 7V4z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div id="topEmployeesFilters" class="hidden mt-4 flex items-center space-x-4">
                        <div class="flex items-center space-x-2">
                            <label class="text-sm text-gray-600">Filtrar por:</label>
                            <select id="topEmployeesMonthFilter" onchange="filterTopEmployeesByMonthYear()" class="bg-gray-100 border border-gray-300 rounded-lg px-3 py-1 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">Todos os meses</option>
                                <option value="0">Janeiro</option>
                                <option value="1">Fevereiro</option>
                                <option value="2">Março</option>
                                <option value="3">Abril</option>
                                <option value="4">Maio</option>
                                <option value="5">Junho</option>
                                <option value="6">Julho</option>
                                <option value="7">Agosto</option>
                                <option value="8">Setembro</option>
                                <option value="9" selected>Outubro</option>
                                <option value="10">Novembro</option>
                                <option value="11">Dezembro</option>
                            </select>
                            <input type="number" id="topEmployeesYearFilter" placeholder="Ano" value="2025" min="2020" max="2030" onchange="filterTopEmployeesByMonthYear()" class="bg-gray-100 border border-gray-300 rounded-lg px-3 py-1 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent w-20">
                            <button onclick="clearTopEmployeesFilter()" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-lg text-sm font-medium transition duration-200">
                                Limpar
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Cards de Funcionários -->
                <div class="space-y-4" id="topEmployeesContainer">
                    <div class="text-center py-8 text-gray-500">
                        Nenhum funcionário com RIDs ainda
                    </div>
                </div>
            </div>

            <!-- Seção Todos os Funcionários -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-100 p-6 mb-8">
                <div class="mb-6">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 rounded-lg flex items-center justify-center" style="background-color: #DBEAFE;">
                                <svg class="w-5 h-5" style="color: #2563EB;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>
                                </svg>
                            </div>
                            <h2 class="text-lg font-bold text-gray-900">Funcionários</h2>
                            <button onclick="toggleEmployeesFilters()" class="w-8 h-8 bg-gray-100 hover:bg-gray-200 border border-gray-300 rounded-lg flex items-center justify-center transition duration-200" title="Mostrar/Ocultar Filtros">
                                <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.707A1 1 0 013 7V4z"></path>
                                </svg>
                            </button>
                        </div>
                        <div>
                            <button onclick="abrirPlanilhaRelatorio()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-medium transition duration-200 flex items-center space-x-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                                <span>Relatório</span>
                            </button>
                        </div>
                    </div>
                    <div id="employeesFilters" class="hidden mt-4 flex items-center space-x-4">
                        <div class="flex items-center space-x-2">
                            <label class="text-sm text-gray-600">Situação:</label>
                            <select id="employeeFilter" onchange="filterEmployeesByDropdown()" class="bg-gray-100 border border-gray-300 rounded-lg px-3 py-1 text-sm">
                                <option value="all">Todos</option>
                                <option value="pending">RIDs Pendentes</option>
                                <option value="inProgress">RIDs em Andamento</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-2">
                            <label class="text-sm text-gray-600">Período:</label>
                            <input type="text" id="employeesStartDate" placeholder="dd/mm/aaaa" onchange="filterEmployeesByDate()" class="bg-gray-100 border border-gray-300 rounded-lg px-3 py-1 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent w-28">
                            <span class="text-gray-500 text-sm">até</span>
                            <input type="text" id="employeesEndDate" placeholder="dd/mm/aaaa" onchange="filterEmployeesByDate()" class="bg-gray-100 border border-gray-300 rounded-lg px-3 py-1 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent w-28">
                            <button onclick="clearEmployeesDateFilter()" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-lg text-sm font-medium transition duration-200">
                                Limpar
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Lista de Funcionários -->
                <div class="space-y-2" id="employeesListContainer">
                    <div class="text-center py-8 text-gray-500">
                        Carregando funcionários...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Funcionário -->
    <div id="employeeDashboard" class="hidden min-h-screen bg-gray-50">
        <!-- Cabeçalho -->
        <header class="bg-gray-100 shadow-sm border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 py-0 flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <img src="https://www.jdemito.com.br/wp-content/themes/jdemito/img/logo.png" alt="Logo" class="w-20 h-20 object-contain" onerror="this.style.display='none';">
                    <div>
                        <h1 class="text-2xl font-bold" style="color: #1E293B;">Sistema RID</h1>
                        <p class="text-sm text-gray-600" id="employeeWelcome">Bem-vindo!</p>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <button onclick="showCreateRidModal()" class="h-10 text-white px-5 py-2 rounded-lg font-medium transition duration-200 text-sm" style="background-color: #16A34A;">
                        Criar Novo RID
                    </button>
                    <button onclick="toggleEmployeeMenu()" class="h-10 w-10 bg-gray-600 hover:bg-gray-700 rounded-lg flex items-center justify-center transition duration-200 relative">
                        <div class="flex flex-col space-y-0.5">
                            <div class="w-4 h-0.5 bg-white"></div>
                            <div class="w-4 h-0.5 bg-white"></div>
                            <div class="w-4 h-0.5 bg-white"></div>
                        </div>
                    </button>
                </div>
            </div>
        </header>

        <!-- Menu Dropdown Funcionário -->
        <div id="employeeDropdownMenu" class="hidden absolute top-16 right-6 bg-white rounded-lg shadow-lg border border-gray-200 z-50 min-w-48">
            <div class="py-2">
                <button onclick="logout()" class="w-full text-left px-4 py-2 text-gray-700 hover:bg-gray-100 flex items-center space-x-2 transition duration-200">
                    <svg class="w-4 h-4 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                    </svg>
                    <span>Sair do Sistema</span>
                </button>
            </div>
        </div>
        
        <div class="max-w-7xl mx-auto p-6">


            <!-- Painel de Métricas -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-100">
                    <div class="flex items-center">
                        <div class="w-12 h-12 rounded-lg flex items-center justify-center" style="background-color: #E0F2FE;">
                            <svg class="w-6 h-6" style="color: #0284C7;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-gray-600">Meus RIDs</p>
                            <p class="text-2xl font-bold text-gray-900" id="myRidsCount">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-100">
                    <div class="flex items-center">
                        <div class="w-12 h-12 rounded-lg flex items-center justify-center" style="background-color: #FEF3C7;">
                            <svg class="w-6 h-6" style="color: #D97706;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-gray-600">Pendentes</p>
                            <p class="text-2xl font-bold text-gray-900" id="pendingCount">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-100">
                    <div class="flex items-center">
                        <div class="w-12 h-12 rounded-lg flex items-center justify-center" style="background-color: #DBEAFE;">
                            <svg class="w-6 h-6" style="color: #2563EB;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-gray-600">Em Andamento</p>
                            <p class="text-2xl font-bold text-gray-900" id="inProgressCount">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-100">
                    <div class="flex items-center">
                        <div class="w-12 h-12 rounded-lg flex items-center justify-center" style="background-color: #DCFCE7;">
                            <svg class="w-6 h-6" style="color: #16A34A;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-gray-600">Concluídos</p>
                            <p class="text-2xl font-bold text-gray-900" id="completedCount">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-sm border border-gray-100 p-6">
                <div class="flex items-center space-x-3 mb-6">
                    <div class="w-8 h-8 rounded-lg flex items-center justify-center" style="background-color: #DBEAFE;">
                        <svg class="w-5 h-5" style="color: #2563EB;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>
                        </svg>
                    </div>
                    <h2 class="text-lg font-bold text-gray-900">Meus RIDs</h2>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-gray-200">
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Número</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Descrição</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Prioridade</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Data</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Status</th>
                            </tr>
                        </thead>
                        <tbody id="employeeRidsTable">
                            <tr>
                                <td colspan="5" class="text-center py-8 text-gray-500">Nenhum RID encontrado</td>
                            </tr>
                        </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal RIDs do Funcionário -->
    <div id="employeeRidsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800" id="modalEmployeeName">RIDs do Funcionário</h2>
                        <p class="text-gray-600" id="modalEmployeeInfo">Outubro 2025</p>
                    </div>
                    <button onclick="closeEmployeeRidsModal()" class="text-gray-500 hover:text-gray-700 text-2xl">×</button>
                </div>
            </div>
            
            <div class="p-6">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-gray-200">
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Número</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Descrição</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Prioridade</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Data</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Status</th>
                            </tr>
                        </thead>
                        <tbody id="modalRidsTable">
                            <tr>
                                <td colspan="5" class="text-center py-8 text-gray-500">Carregando RIDs...</td>
                            </tr>
                        </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Detalhes do RID -->
    <div id="ridDetailsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800" id="ridDetailsTitle">Detalhes do RID</h2>
                        <p class="text-gray-600" id="ridDetailsSubtitle">Informações completas</p>
                    </div>
                    <button onclick="closeRidDetailsModal()" class="text-gray-500 hover:text-gray-700 text-2xl">×</button>
                </div>
            </div>
            
            <div class="p-6" id="ridDetailsContent">
                <!-- Conteúdo será preenchido dinamicamente -->
            </div>
        </div>
    </div>

    <!-- Modal Planilha de Relatório -->
    <div id="planilhaRelatorioModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-2 z-50">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-[95vw] max-h-[95vh] overflow-hidden">
            <div class="p-6 border-b border-gray-200 bg-gradient-to-r from-purple-600 to-purple-700">
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-white">Planilha de Relatório RIDs</h2>
                        <p class="text-purple-100">Visualização completa dos dados em formato de planilha</p>
                    </div>
                    <button onclick="fecharPlanilhaRelatorio()" class="text-white hover:text-purple-200 text-2xl font-bold">×</button>
                </div>
            </div>
            
            <div class="p-6 max-h-[80vh] flex flex-col relative">
                
                <div class="overflow-x-auto overflow-y-auto border-2 border-gray-200 rounded-lg flex-1" style="scrollbar-width: auto;">
                    <div class="min-w-max">
                        <table class="w-full border-collapse border border-gray-300 text-sm" style="min-width: 1800px;">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="border border-gray-300 px-3 py-2 text-left font-semibold min-w-24">Unidade</th>
                                <th class="border border-gray-300 px-3 py-2 text-left font-semibold min-w-20">RID nº</th>
                                <th class="border border-gray-300 px-3 py-2 text-left font-semibold min-w-24">Data da emissão</th>
                                <th class="border border-gray-300 px-3 py-2 text-left font-semibold min-w-32">Emitente</th>
                                <th class="border border-gray-300 px-3 py-2 text-left font-semibold min-w-32">Funcionário / Terceiro / Visitante</th>
                                <th class="border border-gray-300 px-3 py-2 text-left font-semibold min-w-32">Setor / Empresa do emitente</th>
                                <th class="border border-gray-300 px-3 py-2 text-left font-semibold min-w-40">Local do incidente ou desvio</th>
                                <th class="border border-gray-300 px-3 py-2 text-left font-semibold min-w-32">Gênese do incidente ou desvio</th>
                                <th class="border border-gray-300 px-3 py-2 text-left font-semibold min-w-32">Origem da detecção</th>
                                <th class="border border-gray-300 px-3 py-2 text-left font-semibold min-w-48">Descrição</th>
                                <th class="border border-gray-300 px-3 py-2 text-left font-semibold min-w-24">Classificação de risco</th>
                                <th class="border border-gray-300 px-3 py-2 text-left font-semibold min-w-40">Ação imediata</th>
                                <th class="border border-gray-300 px-3 py-2 text-left font-semibold min-w-40">Ações corretivas</th>
                                <th class="border border-gray-300 px-3 py-2 text-left font-semibold min-w-32">Responsável pelas ações</th>
                                <th class="border border-gray-300 px-3 py-2 text-left font-semibold min-w-28">Prazo para conclusão</th>
                                <th class="border border-gray-300 px-3 py-2 text-left font-semibold min-w-24">Data de conclusão</th>
                                <th class="border border-gray-300 px-3 py-2 text-left font-semibold min-w-20">Status</th>
                            </tr>
                        </thead>
                        <tbody id="planilhaRelatorioBody">
                            <!-- Dados serão preenchidos dinamicamente -->
                        </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Botões flutuantes no canto inferior direito -->
            <div class="fixed bottom-6 right-6 flex flex-col space-y-3 z-50">
                <button onclick="salvarAlteracoesPlanilha()" class="bg-green-600 hover:bg-green-700 text-white w-16 h-16 rounded-full font-medium transition duration-200 flex items-center justify-center shadow-lg hover:shadow-xl transform hover:scale-105" title="Salvar Alterações">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
                    </svg>
                </button>
                <button onclick="imprimirPlanilha()" class="bg-purple-600 hover:bg-purple-700 text-white w-16 h-16 rounded-full font-medium transition duration-200 flex items-center justify-center shadow-lg hover:shadow-xl transform hover:scale-105" title="Imprimir Planilha">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                    </svg>
                </button>
                <button onclick="exportarPlanilhaExcel()" class="bg-blue-600 hover:bg-blue-700 text-white w-16 h-16 rounded-full font-medium transition duration-200 flex items-center justify-center shadow-lg hover:shadow-xl transform hover:scale-105" title="Baixar Planilha">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Rodapé com contador e botão fechar -->
            <div class="p-6 border-t border-gray-200 bg-gray-50 flex justify-between items-center">
                <div class="text-sm text-gray-600">
                    <span id="totalRidsRelatorio">0</span> RIDs encontrados
                </div>
                <div>
                    <button onclick="fecharPlanilhaRelatorio()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition duration-200">
                        Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Criar RID -->
    <div id="createRidModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-800">Criar Novo RID</h2>
                    <button onclick="closeCreateRidModal()" class="text-gray-500 hover:text-gray-700 text-2xl">×</button>
                </div>
            </div>
            
            <form id="createRidForm" onsubmit="createAdminRid(event)" class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Emitente -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Emitente</label>
                        <input type="text" id="adminRidEmitente" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>

                    <!-- Tipo de Contrato -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Contrato</label>
                        <select id="adminRidTipoContrato" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Selecione o tipo</option>
                            <option value="Funcionário">Funcionário</option>
                            <option value="Terceiro">Terceiro</option>
                            <option value="Contratado">Contratado</option>
                            <option value="Eventual">Eventual</option>
                            <option value="Visitante">Visitante</option>
                        </select>
                    </div>

                    <!-- Unidade -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Unidade</label>
                        <select id="adminRidUnidade" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Selecione a unidade</option>
                            <option value="Calnamix">Calnamix</option>
                            <option value="Calpi">Calpi</option>
                            <option value="Caltins">Caltins</option>
                            <option value="Formacal">Formacal</option>
                            <option value="Gessotins">Gessotins</option>
                            <option value="Império Caltins">Império Caltins</option>
                            <option value="Minerax">Minerax</option>
                            <option value="Minertins">Minertins</option>
                            <option value="Natical">Natical</option>
                            <option value="Nobretins">Nobretins</option>
                            <option value="Supercal">Supercal</option>
                        </select>
                    </div>

                    <!-- Setor do Emitente -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Setor do Emitente</label>
                        <select id="adminRidSetorEmitente" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Selecione o setor</option>
                            <option value="ADM">ADM</option>
                            <option value="M. MOVEL">M. MOVEL</option>
                            <option value="M. FIXA">M. FIXA</option>
                            <option value="M. ELÉTRICA">M. ELÉTRICA</option>
                            <option value="PRODUÇÃO">PRODUÇÃO</option>
                            <option value="MINA">MINA</option>
                        </select>
                    </div>

                    <!-- Data -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Data da Ocorrência</label>
                        <input type="date" id="adminRidData" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>

                    <!-- Incidente ou Desvios -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Incidente ou Desvios</label>
                        <select id="adminRidIncidenteDesvio" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Selecione o tipo</option>
                            <option value="Condição de Risco">Condição de Risco</option>
                            <option value="Desvio Comportamental">Desvio Comportamental</option>
                            <option value="Dano Material">Dano Material</option>
                            <option value="Quase acidente">Quase acidente</option>
                        </select>
                    </div>

                    <!-- Local da Ocorrência -->
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Local da Ocorrência</label>
                        <input type="text" id="adminRidLocalOcorrencia" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Descreva o local onde ocorreu o incidente" required>
                    </div>

                    <!-- Descrição da Ocorrência -->
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Descrição da Ocorrência</label>
                        <textarea id="adminRidDescricaoOcorrencia" rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Descreva detalhadamente o que aconteceu" required></textarea>
                    </div>

                    <!-- Ação Imediata -->
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ação Imediata</label>
                        <textarea id="adminRidAcaoImediata" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Descreva as ações tomadas imediatamente após o incidente" required></textarea>
                    </div>

                    <!-- Prioridade -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Prioridade</label>
                        <select id="adminRidPrioridade" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Selecione a prioridade</option>
                            <option value="Baixa">Baixa</option>
                            <option value="Média">Média</option>
                            <option value="Alta">Alta</option>
                        </select>
                    </div>

                    <!-- Status -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                        <select id="adminRidStatus" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Selecione o status</option>
                            <option value="vencido">Vencido</option>
                            <option value="corrigido">Corrigido</option>
                        </select>
                    </div>
                </div>

                <div class="flex justify-end space-x-4 mt-8 pt-6 border-t border-gray-200">
                    <button type="button" onclick="closeCreateRidModal()" class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 font-medium transition duration-200">
                        Cancelar
                    </button>
                    <button type="submit" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition duration-200">
                        Criar RID
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Dados em memória
        let employees = [
            {
                id: 1,
                name: "João Silva Santos",
                cpf: "12345678901",
                sector: "PRODUÇÃO",
                password: "123456",
                createdAt: "2024-11-15T10:30:00.000Z"
            },
            {
                id: 2,
                name: "Maria Oliveira Costa",
                cpf: "98765432109",
                sector: "M. FIXA",
                password: "senha123",
                createdAt: "2024-11-20T14:15:00.000Z"
            },
            {
                id: 3,
                name: "Carlos Eduardo Lima",
                cpf: "11122233344",
                sector: "MINA",
                password: "carlos2024",
                createdAt: "2024-12-01T08:45:00.000Z"
            },
            {
                id: 4,
                name: "Ana Paula Ferreira",
                cpf: "55566677788",
                sector: "ADM",
                password: "ana123",
                createdAt: "2024-12-05T16:20:00.000Z"
            },
            {
                id: 5,
                name: "Roberto Machado",
                cpf: "99988877766",
                sector: "M. ELÉTRICA",
                password: "roberto456",
                createdAt: "2024-12-10T09:10:00.000Z"
            },
            {
                id: 6,
                name: "Funcionário Teste",
                cpf: "99999999999",
                sector: "PRODUÇÃO",
                password: "123456",
                createdAt: "2024-12-15T10:00:00.000Z"
            },
            {
                id: 7,
                name: "Juan Carlos",
                cpf: "07050776165",
                sector: "ADM",
                password: "611969",
                createdAt: "2024-01-01T08:00:00.000Z",
                isAdmin: true
            },
            {
                id: 8,
                name: "Administrador Geral",
                cpf: "11223344550",
                sector: "ADM",
                password: "12345",
                createdAt: "2024-01-01T08:00:00.000Z",
                isAdmin: true
            }
        ];
        
        let rids = [
            {
                id: 1,
                number: "RID-0001",
                employeeId: 1,
                employeeName: "João Silva Santos",
                employeeSector: "PRODUÇÃO",
                description: "Derramamento de produto químico no piso da área de produção",
                priority: "Alta",
                status: "Concluído",
                createdAt: "2025-09-24T07:40:00.000Z",
                createdDate: "24/09/2025",
                emitente: "João Silva Santos",
                tipoContrato: "Funcionário",
                unidade: "Natical",
                setorEmitente: "PRODUÇÃO",
                dataOcorrido: "2025-09-24",
                incidenteDesvio: "Condição de Risco",
                localOcorrencia: "Linha de Produção 3 - Setor Químico",
                acaoImediata: "Área isolada, produto neutralizado e piso limpo adequadamente."
            },
            {
                id: 2,
                number: "RID-0002",
                employeeId: 3,
                employeeName: "Carlos Eduardo Lima",
                employeeSector: "MINA",
                description: "Equipamento de proteção individual vencido sendo utilizado",
                priority: "Média",
                status: "Pendente",
                createdAt: "2025-09-25T12:15:00.000Z",
                createdDate: "25/09/2025",
                emitente: "Carlos Eduardo Lima",
                tipoContrato: "Funcionário",
                unidade: "Calnamix",
                setorEmitente: "MINA",
                dataOcorrido: "2025-09-25",
                incidenteDesvio: "Desvio Comportamental",
                localOcorrencia: "Frente de Lavra 1 - Área de Extração",
                acaoImediata: "EPI recolhido e funcionário orientado sobre verificação de validade."
            },
            {
                id: 3,
                number: "RID-0003",
                employeeId: 5,
                employeeName: "Roberto Machado",
                employeeSector: "M. ELÉTRICA",
                description: "Falta de aterramento adequado em equipamento elétrico novo",
                priority: "Alta",
                status: "Pendente",
                createdAt: "2025-09-26T15:50:00.000Z",
                createdDate: "26/09/2025",
                emitente: "Roberto Machado",
                tipoContrato: "Funcionário",
                unidade: "Império Caltins",
                setorEmitente: "M. ELÉTRICA",
                dataOcorrido: "2025-09-26",
                incidenteDesvio: "Condição de Risco",
                localOcorrencia: "Sala de Equipamentos - Novo Compressor",
                acaoImediata: "Equipamento desligado até instalação do aterramento adequado."
            },
            {
                id: 4,
                number: "RID-0004",
                employeeId: 4,
                employeeName: "Ana Paula Ferreira",
                employeeSector: "ADM",
                description: "Saída de emergência obstruída por materiais no escritório",
                priority: "Média",
                status: "Em Andamento",
                createdAt: "2025-09-27T10:25:00.000Z",
                createdDate: "27/09/2025",
                emitente: "Ana Paula Ferreira",
                tipoContrato: "Funcionário",
                unidade: "Gessotins",
                setorEmitente: "ADM",
                dataOcorrido: "2025-09-27",
                incidenteDesvio: "Condição de Risco",
                localOcorrencia: "Escritório Administrativo - Corredor Principal",
                acaoImediata: "Remoção parcial dos materiais e reorganização do espaço."
            },
            {
                id: 5,
                number: "RID-0005",
                employeeId: 2,
                employeeName: "Maria Oliveira Costa",
                employeeSector: "M. FIXA",
                description: "Proteção de segurança removida de serra circular sem autorização",
                priority: "Alta",
                status: "Concluído",
                createdAt: "2025-09-28T13:35:00.000Z",
                createdDate: "28/09/2025",
                emitente: "Maria Oliveira Costa",
                tipoContrato: "Funcionário",
                unidade: "Caltins",
                setorEmitente: "M. FIXA",
                dataOcorrido: "2025-09-28",
                incidenteDesvio: "Desvio Comportamental",
                localOcorrencia: "Oficina Mecânica - Bancada 5",
                acaoImediata: "Proteção reinstalada e funcionário orientado sobre procedimentos."
            },
            {
                id: 6,
                number: "RID-0006",
                employeeId: 3,
                employeeName: "Carlos Eduardo Lima",
                employeeSector: "MINA",
                description: "Funcionário terceirizado sem treinamento adequado operando britadeira",
                priority: "Alta",
                status: "Pendente",
                createdAt: "2025-09-29T08:10:00.000Z",
                createdDate: "29/09/2025",
                emitente: "Carlos Eduardo Lima",
                tipoContrato: "Terceiro",
                unidade: "Nobretins",
                setorEmitente: "MINA",
                dataOcorrido: "2025-09-29",
                incidenteDesvio: "Desvio Comportamental",
                localOcorrencia: "Setor de Britagem - Equipamento BR-02",
                acaoImediata: "Operação suspensa até conclusão do treinamento obrigatório."
            },
            {
                id: 7,
                number: "RID-0007",
                employeeId: 1,
                employeeName: "João Silva Santos",
                employeeSector: "PRODUÇÃO",
                description: "Material empilhado de forma inadequada criando risco de queda",
                priority: "Média",
                status: "Em Andamento",
                createdAt: "2025-09-30T14:20:00.000Z",
                createdDate: "30/09/2025",
                emitente: "João Silva Santos",
                tipoContrato: "Funcionário",
                unidade: "Formacal",
                setorEmitente: "PRODUÇÃO",
                dataOcorrido: "2025-09-30",
                incidenteDesvio: "Condição de Risco",
                localOcorrencia: "Depósito de Materiais - Seção A",
                acaoImediata: "Reorganização do empilhamento conforme normas de segurança."
            },
            {
                id: 8,
                number: "RID-0008",
                employeeId: 5,
                employeeName: "Roberto Machado",
                employeeSector: "M. ELÉTRICA",
                description: "Curto-circuito no painel de controle da esteira 2",
                priority: "Alta",
                status: "Concluído",
                createdAt: "2025-10-01T11:45:00.000Z",
                createdDate: "01/10/2025",
                emitente: "Roberto Machado",
                tipoContrato: "Funcionário",
                unidade: "Minerax",
                setorEmitente: "M. ELÉTRICA",
                dataOcorrido: "2025-10-01",
                incidenteDesvio: "Dano Material",
                localOcorrencia: "Painel Elétrico - Esteira Transportadora 2",
                acaoImediata: "Energia desligada e painel substituído por um novo."
            },
            {
                id: 9,
                number: "RID-0009",
                employeeId: 4,
                employeeName: "Ana Paula Ferreira",
                employeeSector: "ADM",
                description: "Funcionário utilizando celular durante operação de empilhadeira",
                priority: "Alta",
                status: "Pendente",
                createdAt: "2025-10-02T16:30:00.000Z",
                createdDate: "02/10/2025",
                emitente: "Ana Paula Ferreira",
                tipoContrato: "Funcionário",
                unidade: "Supercal",
                setorEmitente: "ADM",
                dataOcorrido: "2025-10-02",
                incidenteDesvio: "Desvio Comportamental",
                localOcorrencia: "Pátio de Estocagem - Área C",
                acaoImediata: "Operação interrompida e orientação sobre segurança aplicada."
            },
            {
                id: 10,
                number: "RID-0010",
                employeeId: 2,
                employeeName: "Maria Oliveira Costa",
                employeeSector: "M. FIXA",
                description: "Vazamento de óleo na bomba hidráulica da prensa 4",
                priority: "Alta",
                status: "Em Andamento",
                createdAt: "2025-10-03T09:15:00.000Z",
                createdDate: "03/10/2025",
                emitente: "Maria Oliveira Costa",
                tipoContrato: "Funcionário",
                unidade: "Caltins",
                setorEmitente: "M. FIXA",
                dataOcorrido: "2025-10-03",
                incidenteDesvio: "Condição de Risco",
                localOcorrencia: "Setor de Prensagem - Prensa 4",
                acaoImediata: "Área isolada e equipamento desligado para manutenção."
            },
            {
                id: 11,
                number: "RID-0011",
                employeeId: 3,
                employeeName: "Carlos Eduardo Lima",
                employeeSector: "MINA",
                description: "Iluminação inadequada no túnel secundário",
                priority: "Baixa",
                status: "Concluído",
                createdAt: "2025-10-04T14:20:00.000Z",
                createdDate: "04/10/2025",
                emitente: "Carlos Eduardo Lima",
                tipoContrato: "Funcionário",
                unidade: "Minertins",
                setorEmitente: "MINA",
                dataOcorrido: "2025-10-04",
                incidenteDesvio: "Condição de Risco",
                localOcorrencia: "Túnel Secundário - Seção B",
                acaoImediata: "Instalação de luminárias LED adicionais."
            },
            {
                id: 12,
                number: "RID-0012",
                employeeId: 1,
                employeeName: "João Silva Santos",
                employeeSector: "PRODUÇÃO",
                description: "Ferramenta defeituosa causando risco de acidente",
                priority: "Alta",
                status: "Pendente",
                createdAt: "2025-10-05T12:45:00.000Z",
                createdDate: "05/10/2025",
                emitente: "João Silva Santos",
                tipoContrato: "Funcionário",
                unidade: "Minerax",
                setorEmitente: "PRODUÇÃO",
                dataOcorrido: "2025-10-05",
                incidenteDesvio: "Condição de Risco",
                localOcorrencia: "Bancada de Trabalho - Setor A",
                acaoImediata: "Ferramenta retirada de uso e substituída por uma nova."
            },
            {
                id: 13,
                number: "RID-0013",
                employeeId: 5,
                employeeName: "Roberto Machado",
                employeeSector: "M. ELÉTRICA",
                description: "Sobrecarga no quadro elétrico do setor de produção",
                priority: "Alta",
                status: "Concluído",
                createdAt: "2025-10-06T16:30:00.000Z",
                createdDate: "06/10/2025",
                emitente: "Roberto Machado",
                tipoContrato: "Funcionário",
                unidade: "Supercal",
                setorEmitente: "M. ELÉTRICA",
                dataOcorrido: "2025-10-06",
                incidenteDesvio: "Condição de Risco",
                localOcorrencia: "Quadro Elétrico Principal - Setor Produção",
                acaoImediata: "Redistribuição de cargas e instalação de novo disjuntor."
            },
            {
                id: 14,
                number: "RID-0014",
                employeeId: 4,
                employeeName: "Ana Paula Ferreira",
                employeeSector: "ADM",
                description: "Piso escorregadio na entrada do prédio administrativo após chuva",
                priority: "Média",
                status: "Pendente",
                createdAt: "2025-10-07T10:15:00.000Z",
                createdDate: "07/10/2025",
                emitente: "Ana Paula Ferreira",
                tipoContrato: "Funcionário",
                unidade: "Caltins",
                setorEmitente: "ADM",
                dataOcorrido: "2025-10-07",
                incidenteDesvio: "Condição de Risco",
                localOcorrencia: "Entrada Principal - Prédio Administrativo",
                acaoImediata: "Colocação de tapetes antiderrapantes e placas de sinalização."
            },
            {
                id: 15,
                number: "RID-0015",
                employeeId: 3,
                employeeName: "Carlos Eduardo Lima",
                employeeSector: "MINA",
                description: "Funcionário terceirizado não utilizando capacete em área obrigatória",
                priority: "Alta",
                status: "Concluído",
                createdAt: "2025-10-08T09:10:00.000Z",
                createdDate: "08/10/2025",
                emitente: "Carlos Eduardo Lima",
                tipoContrato: "Terceiro",
                unidade: "Nobretins",
                setorEmitente: "MINA",
                dataOcorrido: "2025-10-08",
                incidenteDesvio: "Desvio Comportamental",
                localOcorrencia: "Área de Extração - Frente de Lavra 3",
                acaoImediata: "Trabalho suspenso, capacete fornecido e treinamento de segurança aplicado."
            },
            {
                id: 16,
                number: "RID-0016",
                employeeId: 5,
                employeeName: "Roberto Machado",
                employeeSector: "M. ELÉTRICA",
                description: "Cabo elétrico desencapado próximo à área de circulação de funcionários",
                priority: "Alta",
                status: "Pendente",
                createdAt: "2025-10-09T15:45:00.000Z",
                createdDate: "09/10/2025",
                emitente: "Roberto Machado",
                tipoContrato: "Funcionário",
                unidade: "Formacal",
                setorEmitente: "M. ELÉTRICA",
                dataOcorrido: "2025-10-09",
                incidenteDesvio: "Condição de Risco",
                localOcorrencia: "Corredor Principal - Próximo ao Refeitório",
                acaoImediata: "Área isolada com barreiras e energia desligada no setor."
            },
            {
                id: 17,
                number: "RID-0017",
                employeeId: 4,
                employeeName: "Ana Paula Ferreira",
                employeeSector: "ADM",
                description: "Extintor de incêndio com prazo de validade vencido no escritório",
                priority: "Baixa",
                status: "Concluído",
                createdAt: "2025-10-10T13:20:00.000Z",
                createdDate: "10/10/2025",
                emitente: "Ana Paula Ferreira",
                tipoContrato: "Funcionário",
                unidade: "Caltins",
                setorEmitente: "ADM",
                dataOcorrido: "2025-10-10",
                incidenteDesvio: "Condição de Risco",
                localOcorrencia: "Escritório Administrativo - Sala 12",
                acaoImediata: "Extintor substituído imediatamente por um novo dentro da validade."
            },
            {
                id: 18,
                number: "RID-0018",
                employeeId: 2,
                employeeName: "Maria Oliveira Costa",
                employeeSector: "M. FIXA",
                description: "Dano no motor da britadeira por falta de lubrificação adequada",
                priority: "Média",
                status: "Concluído",
                createdAt: "2025-10-11T11:30:00.000Z",
                createdDate: "11/10/2025",
                emitente: "Maria Oliveira Costa",
                tipoContrato: "Funcionário",
                unidade: "Supercal",
                setorEmitente: "M. FIXA",
                dataOcorrido: "2025-10-11",
                incidenteDesvio: "Dano Material",
                localOcorrencia: "Setor de Britagem - Equipamento BR-05",
                acaoImediata: "Motor substituído e cronograma de lubrificação revisado."
            },
            {
                id: 19,
                number: "RID-0019",
                employeeId: 3,
                employeeName: "Carlos Eduardo Lima",
                employeeSector: "MINA",
                description: "Rachadura identificada na parede do túnel de acesso principal",
                priority: "Alta",
                status: "Pendente",
                createdAt: "2025-10-12T07:15:00.000Z",
                createdDate: "12/10/2025",
                emitente: "Carlos Eduardo Lima",
                tipoContrato: "Funcionário",
                unidade: "Minertins",
                setorEmitente: "MINA",
                dataOcorrido: "2025-10-12",
                incidenteDesvio: "Condição de Risco",
                localOcorrencia: "Túnel Principal - Seção A, Metro 45",
                acaoImediata: "Área sinalizada e acesso restrito até avaliação estrutural."
            },
            {
                id: 20,
                number: "RID-0020",
                employeeId: 1,
                employeeName: "João Silva Santos",
                employeeSector: "PRODUÇÃO",
                description: "Queda de material da esteira transportadora por sobrecarga",
                priority: "Média",
                status: "Pendente",
                createdAt: "2025-10-13T16:45:00.000Z",
                createdDate: "13/10/2025",
                emitente: "João Silva Santos",
                tipoContrato: "Funcionário",
                unidade: "Caltins",
                setorEmitente: "PRODUÇÃO",
                dataOcorrido: "2025-10-13",
                incidenteDesvio: "Quase acidente",
                localOcorrencia: "Esteira Transportadora Principal - KM 150",
                acaoImediata: "Material recolhido e esteira ajustada para capacidade adequada."
            },
            {
                id: 21,
                number: "RID-0021",
                employeeId: 2,
                employeeName: "Maria Oliveira Costa",
                employeeSector: "M. FIXA",
                description: "Funcionário operando equipamento sem EPI adequado (óculos de proteção)",
                priority: "Alta",
                status: "Concluído",
                createdAt: "2025-10-14T14:20:00.000Z",
                createdDate: "14/10/2025",
                emitente: "Maria Oliveira Costa",
                tipoContrato: "Funcionário",
                unidade: "Minerax",
                setorEmitente: "M. FIXA",
                dataOcorrido: "2025-10-14",
                incidenteDesvio: "Desvio Comportamental",
                localOcorrencia: "Oficina de Manutenção - Bancada 3",
                acaoImediata: "Trabalho interrompido imediatamente. EPI fornecido e orientação realizada."
            },
            {
                id: 22,
                number: "RID-0022",
                employeeId: 1,
                employeeName: "João Silva Santos",
                employeeSector: "PRODUÇÃO",
                description: "Vazamento de óleo hidráulico na prensa principal causando risco de escorregão",
                priority: "Alta",
                status: "Pendente",
                createdAt: "2025-10-15T08:30:00.000Z",
                createdDate: "15/10/2025",
                emitente: "João Silva Santos",
                tipoContrato: "Funcionário",
                unidade: "Caltins",
                setorEmitente: "PRODUÇÃO",
                dataOcorrido: "2025-10-15",
                incidenteDesvio: "Condição de Risco",
                localOcorrencia: "Setor de Prensagem - Linha 2",
                acaoImediata: "Área isolada com cones e fita zebrada. Limpeza emergencial realizada."
            },
            {
                id: 23,
                number: "RID-0023",
                employeeId: 7,
                employeeName: "Juan Carlos",
                employeeSector: "ADM",
                description: "Revisão geral dos procedimentos de segurança no setor administrativo",
                priority: "Média",
                status: "Em Andamento",
                createdAt: "2025-10-16T09:00:00.000Z",
                createdDate: "16/10/2025",
                emitente: "Juan Carlos",
                tipoContrato: "Funcionário",
                unidade: "Caltins",
                setorEmitente: "ADM",
                dataOcorrido: "2025-10-16",
                incidenteDesvio: "Condição de Risco",
                localOcorrencia: "Prédio Administrativo - Todos os Setores",
                acaoImediata: "Iniciada auditoria completa dos procedimentos de segurança."
            },
            {
                id: 24,
                number: "RID-0024",
                employeeId: 8,
                employeeName: "Administrador Geral",
                employeeSector: "ADM",
                description: "Implementação de novo sistema de controle de acesso às áreas restritas",
                priority: "Alta",
                status: "Concluído",
                createdAt: "2025-10-17T14:30:00.000Z",
                createdDate: "17/10/2025",
                emitente: "Administrador Geral",
                tipoContrato: "Funcionário",
                unidade: "Supercal",
                setorEmitente: "ADM",
                dataOcorrido: "2025-10-17",
                incidenteDesvio: "Condição de Risco",
                localOcorrencia: "Portarias e Acessos Principais",
                acaoImediata: "Sistema de cartões magnéticos instalado e funcionando."
            }
        ];
        
        let currentUser = null;
        let ridCounter = 25;

        // Funções de navegação
        function showLogin() {
            hideAllScreens();
            document.getElementById('loginScreen').classList.remove('hidden');
        }

        function showEmployeeRegister() {
            hideAllScreens();
            document.getElementById('employeeRegisterScreen').classList.remove('hidden');
        }

        function hideAllScreens() {
            const screens = ['loginScreen', 'employeeRegisterScreen', 'adminDashboard', 'employeeDashboard'];
            screens.forEach(screen => {
                document.getElementById(screen).classList.add('hidden');
            });
        }

        // CPFs de administradores automáticos
        const adminCpfs = ['07050776165', '11223344550', '07050753114', '23568974100'];

        // Login universal - detecta automaticamente se é admin ou funcionário
        function universalLogin(event) {
            event.preventDefault();
            const cpf = document.getElementById('loginCpf').value.replace(/\D/g, '');
            const password = document.getElementById('loginPassword').value;
            
            // Verifica se é o administrador principal (Juan Carlos)
            if (cpf === '07050776165' && password === '611969') {
                currentUser = { type: 'admin', cpf: cpf, name: 'Juan Carlos' };
                hideAllScreens();
                document.getElementById('adminDashboard').classList.remove('hidden');
                loadAdminDashboard();
                return;
            }
            
            // Segundo administrador fixo
            if (cpf === '11223344550' && password === '12345') {
                currentUser = { type: 'admin', cpf: cpf };
                hideAllScreens();
                document.getElementById('adminDashboard').classList.remove('hidden');
                loadAdminDashboard();
                return;
            }
            
            // Verifica se é um funcionário cadastrado
            const employee = employees.find(emp => emp.cpf === cpf && emp.password === password);
            if (employee) {
                // Verificar se é um dos administradores automáticos
                if (adminCpfs.includes(employee.cpf) || employee.isAdmin) {
                    currentUser = { type: 'admin', cpf: cpf, name: employee.name };
                    hideAllScreens();
                    document.getElementById('adminDashboard').classList.remove('hidden');
                    loadAdminDashboard();
                    return;
                }
                
                currentUser = { type: 'employee', ...employee };
                hideAllScreens();
                document.getElementById('employeeDashboard').classList.remove('hidden');
                loadEmployeeDashboard();
                return;
            }
            

            
            // Se não encontrou nenhum usuário válido
            showError('loginError', 'CPF ou senha incorretos');
        }

        // Cadastro de funcionário
        function employeeRegister(event) {
            event.preventDefault();
            const name = document.getElementById('empRegName').value;
            const cpf = document.getElementById('empRegCpf').value.replace(/\D/g, '');
            const sector = document.getElementById('empRegSector').value;
            const password = document.getElementById('empRegPassword').value;

            if (employees.find(emp => emp.cpf === cpf)) {
                showError('empRegError', 'CPF já cadastrado');
                return;
            }

            // Verificar se o CPF é de um administrador automático
            const isAutoAdmin = adminCpfs.includes(cpf);

            const employee = {
                id: employees.length + 1,
                name: name,
                cpf: cpf,
                sector: sector,
                password: password,
                createdAt: new Date().toISOString(),
                isAdmin: isAutoAdmin
            };

            employees.push(employee);
            
            let successMessage = 'Cadastro realizado com sucesso! Faça login para continuar.';
            if (isAutoAdmin) {
                successMessage = 'Cadastro realizado com sucesso! Você foi automaticamente identificado como ADMINISTRADOR. Faça login para acessar o painel administrativo.';
            }
            
            showSuccess('empRegSuccess', successMessage);
            
            // Preencher automaticamente o CPF no campo de login
            document.getElementById('loginCpf').value = formatCpf(cpf);
            
            showLogin();
        }

        // Carregar dashboard administrativo
        function loadAdminDashboard() {
            // Atualizar mensagem de boas-vindas
            const welcomeMessage = currentUser && currentUser.name ? `Bem-vindo, ${currentUser.name}` : 'Bem-vindo, Administrador';
            document.getElementById('adminWelcome').textContent = welcomeMessage;
            
            // Atualizar métricas
            document.getElementById('totalRids').textContent = rids.length;
            
            const pendingCount = rids.filter(rid => rid.status === 'Pendente').length;
            const resolvedCount = rids.filter(rid => rid.status === 'Concluído').length;
            
            document.getElementById('pendingRids').textContent = pendingCount;
            document.getElementById('resolvedRids').textContent = resolvedCount;
            
            // RIDs do mês atual (outubro 2025)
            const targetMonth = 9; // Outubro (0-indexado)
            const targetYear = 2025;
            const monthRids = rids.filter(rid => {
                const ridDate = new Date(rid.createdAt);
                return ridDate.getMonth() === targetMonth && ridDate.getFullYear() === targetYear;
            });
            document.getElementById('monthRids').textContent = monthRids.length;

            // Inicializar filtros de data e carregar top 3 funcionários
            initializeDateFilters();
            loadTopEmployees();
            
            // Carregar lista de funcionários
            loadAllEmployees();
        }

        // Variáveis para controlar o período selecionado no filtro do top 3
        let selectedMonth = 9; // Outubro (0-indexado)
        let selectedYear = 2025;

        // Variáveis para controlar o período selecionado no filtro de funcionários
        let employeesSelectedStartDate = null;
        let employeesSelectedEndDate = null;

        // Função para converter data do formato dd/mm/aaaa para objeto Date
        function parseDate(dateString) {
            if (!dateString) return null;
            
            const parts = dateString.split('/');
            if (parts.length !== 3) return null;
            
            const day = parseInt(parts[0], 10);
            const month = parseInt(parts[1], 10) - 1; // Mês é 0-indexado
            const year = parseInt(parts[2], 10);
            
            if (isNaN(day) || isNaN(month) || isNaN(year)) return null;
            if (day < 1 || day > 31) return null;
            if (month < 0 || month > 11) return null;
            if (year < 1900 || year > 2100) return null;
            
            return new Date(year, month, day);
        }

        // Função para inicializar os campos de data
        function initializeDateFilters() {
            // Definir período padrão como outubro de 2025
            selectedMonth = 9; // Outubro (0-indexado)
            selectedYear = 2025;
            
            // Definir valores nos campos
            document.getElementById('topEmployeesMonthFilter').value = '9';
            document.getElementById('topEmployeesYearFilter').value = '2025';
        }

        // Função para filtrar top funcionários por mês e ano
        function filterTopEmployeesByMonthYear() {
            const monthSelect = document.getElementById('topEmployeesMonthFilter');
            const yearInput = document.getElementById('topEmployeesYearFilter');
            
            // Obter valores selecionados
            const monthValue = monthSelect.value;
            const yearValue = parseInt(yearInput.value);
            
            // Validar ano
            if (yearValue && (yearValue < 2020 || yearValue > 2030)) {
                alert('Por favor, digite um ano entre 2020 e 2030');
                return;
            }
            
            // Atualizar variáveis globais
            selectedMonth = monthValue === '' ? null : parseInt(monthValue);
            selectedYear = yearValue || null;
            
            loadTopEmployees();
        }

        // Função para limpar filtro do top 3 funcionários
        function clearTopEmployeesFilter() {
            selectedMonth = null;
            selectedYear = null;
            document.getElementById('topEmployeesMonthFilter').value = '';
            document.getElementById('topEmployeesYearFilter').value = '';
            loadTopEmployees();
        }

        // Carregar top 3 funcionários com mais RIDs
        function loadTopEmployees() {
            const employeeStats = {};
            
            // Filtrar RIDs pelo mês e ano selecionados
            let filteredRids = rids;
            
            if (selectedMonth !== null || selectedYear !== null) {
                filteredRids = rids.filter(rid => {
                    const ridDate = new Date(rid.createdAt);
                    
                    // Se apenas mês foi selecionado, filtrar por mês em qualquer ano
                    if (selectedMonth !== null && selectedYear === null) {
                        return ridDate.getMonth() === selectedMonth;
                    }
                    
                    // Se apenas ano foi selecionado, filtrar por ano em qualquer mês
                    if (selectedMonth === null && selectedYear !== null) {
                        return ridDate.getFullYear() === selectedYear;
                    }
                    
                    // Se ambos foram selecionados, filtrar por mês e ano específicos
                    if (selectedMonth !== null && selectedYear !== null) {
                        return ridDate.getMonth() === selectedMonth && ridDate.getFullYear() === selectedYear;
                    }
                    
                    return true;
                });
            }
            
            // Contar RIDs por funcionário
            filteredRids.forEach(rid => {
                if (!employeeStats[rid.employeeId]) {
                    const employee = employees.find(emp => emp.id === rid.employeeId);
                    if (employee) {
                        employeeStats[rid.employeeId] = {
                            ...employee,
                            totalRids: 0,
                            pendingRids: 0,
                            resolvedRids: 0
                        };
                    }
                }
                
                if (employeeStats[rid.employeeId]) {
                    employeeStats[rid.employeeId].totalRids++;
                    if (rid.status === 'Pendente') {
                        employeeStats[rid.employeeId].pendingRids++;
                    } else if (rid.status === 'Concluído') {
                        employeeStats[rid.employeeId].resolvedRids++;
                    }
                }
            });

            // Ordenar por total de RIDs e pegar top 3
            const topEmployees = Object.values(employeeStats)
                .sort((a, b) => b.totalRids - a.totalRids)
                .slice(0, 3);

            const container = document.getElementById('topEmployeesContainer');
            
            if (topEmployees.length === 0) {
                let message = 'Nenhum funcionário com RIDs no período selecionado';
                
                // Criar mensagem baseada nos filtros aplicados
                const monthNames = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 
                                  'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                
                if (selectedMonth !== null && selectedYear !== null) {
                    message = `Nenhum funcionário com RIDs em ${monthNames[selectedMonth]} de ${selectedYear}`;
                } else if (selectedMonth !== null && selectedYear === null) {
                    message = `Nenhum funcionário com RIDs em ${monthNames[selectedMonth]}`;
                } else if (selectedMonth === null && selectedYear !== null) {
                    message = `Nenhum funcionário com RIDs em ${selectedYear}`;
                } else {
                    message = 'Nenhum funcionário com RIDs ainda';
                }
                
                container.innerHTML = `<div class="text-center py-8 text-gray-500">${message}</div>`;
                return;
            }

            const positions = [
                { place: '1º Lugar', color: '#FACC15', borderColor: 'border-yellow-400' },
                { place: '2º Lugar', color: '#60A5FA', borderColor: 'border-blue-400' },
                { place: '3º Lugar', color: '#FB923C', borderColor: 'border-orange-400' }
            ];

            container.innerHTML = topEmployees.map((employee, index) => {
                const position = positions[index];
                return `
                    <div class="bg-white border-l-4 ${position.borderColor} rounded-lg p-4 shadow-sm">
                        <div class="flex justify-between items-center">
                            <div class="flex-1">
                                <div class="flex items-center space-x-3">
                                    <h3 class="font-bold text-gray-900">${employee.name}</h3>
                                    <span class="px-2 py-1 text-xs rounded-full text-white" style="background-color: ${position.color};">
                                        ${position.place}
                                    </span>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold text-gray-900">${employee.totalRids}</div>
                                <div class="text-sm text-gray-500">RID${employee.totalRids !== 1 ? 's' : ''}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Função para formatar CPF
        function formatCpf(cpf) {
            return cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
        }

        // Variáveis para controlar os filtros atuais
        let currentFilter = 'all';

        // Função para filtrar funcionários por período de data
        function filterEmployeesByDate() {
            const startDateInput = document.getElementById('employeesStartDate');
            const endDateInput = document.getElementById('employeesEndDate');
            
            if (startDateInput.value) {
                employeesSelectedStartDate = parseDate(startDateInput.value);
                if (!employeesSelectedStartDate) {
                    alert('Data inicial inválida! Use o formato dd/mm/aaaa');
                    return;
                }
                employeesSelectedStartDate.setHours(1, 0, 0, 0); // Começar às 01:00
            } else {
                employeesSelectedStartDate = null;
            }
            
            if (endDateInput.value) {
                employeesSelectedEndDate = parseDate(endDateInput.value);
                if (!employeesSelectedEndDate) {
                    alert('Data final inválida! Use o formato dd/mm/aaaa');
                    return;
                }
                employeesSelectedEndDate.setHours(23, 59, 59, 999); // Final do dia
            } else {
                employeesSelectedEndDate = null;
            }
            
            // Validar se a data inicial não é maior que a final
            if (employeesSelectedStartDate && employeesSelectedEndDate && employeesSelectedStartDate > employeesSelectedEndDate) {
                alert('A data inicial não pode ser maior que a data final!');
                return;
            }
            
            loadAllEmployees();
        }

        // Função para limpar filtro de datas dos funcionários
        function clearEmployeesDateFilter() {
            employeesSelectedStartDate = null;
            employeesSelectedEndDate = null;
            document.getElementById('employeesStartDate').value = '';
            document.getElementById('employeesEndDate').value = '';
            loadAllEmployees();
        }

        // Função para mostrar/ocultar filtros dos funcionários
        function toggleEmployeesFilters() {
            const filtersDiv = document.getElementById('employeesFilters');
            if (filtersDiv.classList.contains('hidden')) {
                filtersDiv.classList.remove('hidden');
            } else {
                filtersDiv.classList.add('hidden');
            }
        }

        // Função para mostrar/ocultar filtros do top 3 funcionários
        function toggleTopEmployeesFilters() {
            const filtersDiv = document.getElementById('topEmployeesFilters');
            if (filtersDiv.classList.contains('hidden')) {
                filtersDiv.classList.remove('hidden');
            } else {
                filtersDiv.classList.add('hidden');
            }
        }

        // Carregar lista de todos os funcionários
        function loadAllEmployees() {
            const container = document.getElementById('employeesListContainer');
            
            // Filtrar funcionários para excluir apenas o Administrador Geral (CPF: 11223344550)
            const regularEmployees = employees.filter(emp => emp.cpf !== '11223344550');
            const sortedEmployees = [...regularEmployees].sort((a, b) => a.name.localeCompare(b.name));
            
            if (sortedEmployees.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-gray-500">Nenhum funcionário cadastrado</div>';
                return;
            }

            // Aplicar filtro baseado na seleção atual
            const filteredEmployees = filterEmployeesByStatus(sortedEmployees, currentFilter);

            if (filteredEmployees.length === 0) {
                const filterText = currentFilter === 'pending' ? 'com RIDs pendentes' : 
                                 currentFilter === 'inProgress' ? 'com RIDs em andamento' : '';
                container.innerHTML = `<div class="text-center py-8 text-gray-500">Nenhum funcionário ${filterText} encontrado</div>`;
                return;
            }

            container.innerHTML = filteredEmployees.map(employee => {
                // Filtrar RIDs do funcionário por período se selecionado
                let employeeRids = rids.filter(rid => rid.employeeId === employee.id);
                
                if (employeesSelectedStartDate || employeesSelectedEndDate) {
                    employeeRids = employeeRids.filter(rid => {
                        const ridDate = new Date(rid.createdAt);
                        
                        // Se apenas data inicial foi selecionada, mostrar RIDs a partir dessa data
                        if (employeesSelectedStartDate && !employeesSelectedEndDate) {
                            return ridDate >= employeesSelectedStartDate;
                        }
                        
                        // Se apenas data final foi selecionada, mostrar RIDs até essa data
                        if (!employeesSelectedStartDate && employeesSelectedEndDate) {
                            return ridDate <= employeesSelectedEndDate;
                        }
                        
                        // Se ambas as datas foram selecionadas, mostrar RIDs no período
                        if (employeesSelectedStartDate && employeesSelectedEndDate) {
                            return ridDate >= employeesSelectedStartDate && ridDate <= employeesSelectedEndDate;
                        }
                        
                        return true;
                    });
                } else {
                    // Se não há filtro de data, mostrar RIDs do mês atual (outubro 2025)
                    const currentMonth = 9; // Outubro (0-indexado)
                    const currentYear = 2025;
                    employeeRids = employeeRids.filter(rid => {
                        const ridDate = new Date(rid.createdAt);
                        return ridDate.getMonth() === currentMonth && ridDate.getFullYear() === currentYear;
                    });
                }

                // Determinar o texto do período baseado nas datas realmente selecionadas
                let periodText = 'em outubro';
                const startDateInput = document.getElementById('employeesStartDate');
                const endDateInput = document.getElementById('employeesEndDate');
                
                if (startDateInput.value && endDateInput.value) {
                    periodText = `${startDateInput.value}-${endDateInput.value}`;
                } else if (startDateInput.value && !endDateInput.value) {
                    periodText = `desde ${startDateInput.value}`;
                } else if (!startDateInput.value && endDateInput.value) {
                    periodText = `até ${endDateInput.value}`;
                }

                return `
                    <div class="bg-white hover:bg-blue-50 border border-gray-200 hover:border-blue-300 rounded-lg p-4 cursor-pointer transition duration-200 hover:shadow-md" onclick="showEmployeeRids(${employee.id})">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4">
                                <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                                    <span class="text-blue-600 font-semibold">${employee.name.charAt(0)}</span>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-900">${employee.name}</h3>
                                    <p class="text-sm text-gray-600">${employee.sector}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-lg font-bold text-blue-600">${employeeRids.length}</div>
                                <div class="text-xs text-gray-500">RID${employeeRids.length !== 1 ? 's' : ''}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Função para filtrar funcionários por status dos RIDs
        function filterEmployeesByStatus(employees, filter) {
            if (filter === 'all') {
                return employees;
            }
            
            return employees.filter(employee => {
                // Excluir apenas o Administrador Geral da filtragem
                if (employee.cpf === '11223344550') {
                    return false;
                }
                
                const employeeRids = rids.filter(rid => rid.employeeId === employee.id);
                
                if (filter === 'pending') {
                    return employeeRids.some(rid => rid.status === 'Pendente');
                } else if (filter === 'inProgress') {
                    return employeeRids.some(rid => rid.status === 'Em Andamento');
                }
                
                return false;
            });
        }

        // Função para aplicar filtros nos funcionários via dropdown
        function filterEmployeesByDropdown() {
            const filterSelect = document.getElementById('employeeFilter');
            currentFilter = filterSelect.value;
            
            // Recarregar lista de funcionários com o filtro aplicado
            loadAllEmployees();
        }

        // Mostrar RIDs do funcionário no modal
        function showEmployeeRids(employeeId) {
            const employee = employees.find(emp => emp.id === employeeId);
            if (!employee) return;

            // Filtrar RIDs do funcionário baseado no período selecionado
            let employeeRids = rids.filter(rid => rid.employeeId === employeeId);
            let periodInfo = '';

            if (employeesSelectedStartDate || employeesSelectedEndDate) {
                employeeRids = employeeRids.filter(rid => {
                    const ridDate = new Date(rid.createdAt);
                    
                    // Se apenas data inicial foi selecionada, mostrar RIDs a partir dessa data
                    if (employeesSelectedStartDate && !employeesSelectedEndDate) {
                        return ridDate >= employeesSelectedStartDate;
                    }
                    
                    // Se apenas data final foi selecionada, mostrar RIDs até essa data
                    if (!employeesSelectedStartDate && employeesSelectedEndDate) {
                        return ridDate <= employeesSelectedEndDate;
                    }
                    
                    // Se ambas as datas foram selecionadas, mostrar RIDs no período
                    if (employeesSelectedStartDate && employeesSelectedEndDate) {
                        return ridDate >= employeesSelectedStartDate && ridDate <= employeesSelectedEndDate;
                    }
                    
                    return true;
                });
                
                // Definir texto do período
                if (employeesSelectedStartDate && employeesSelectedEndDate) {
                    const startStr = employeesSelectedStartDate.toLocaleDateString('pt-BR');
                    const endStr = employeesSelectedEndDate.toLocaleDateString('pt-BR');
                    periodInfo = `${startStr} a ${endStr}`;
                } else if (employeesSelectedStartDate && !employeesSelectedEndDate) {
                    const startStr = employeesSelectedStartDate.toLocaleDateString('pt-BR');
                    periodInfo = `A partir de ${startStr}`;
                } else if (!employeesSelectedStartDate && employeesSelectedEndDate) {
                    const endStr = employeesSelectedEndDate.toLocaleDateString('pt-BR');
                    periodInfo = `Até ${endStr}`;
                }
            } else {
                // Se não há filtro de data, mostrar RIDs do mês atual (outubro 2025)
                const currentMonth = 9; // Outubro (0-indexado)
                const currentYear = 2025;
                employeeRids = employeeRids.filter(rid => {
                    const ridDate = new Date(rid.createdAt);
                    return ridDate.getMonth() === currentMonth && ridDate.getFullYear() === currentYear;
                });
                
                periodInfo = `Outubro 2025`;
            }

            // Atualizar informações do modal
            document.getElementById('modalEmployeeName').textContent = `RIDs de ${employee.name}`;
            document.getElementById('modalEmployeeInfo').textContent = `${employee.sector} • ${periodInfo} • ${employeeRids.length} RID${employeeRids.length !== 1 ? 's' : ''}`;

            // Atualizar tabela de RIDs
            const tableBody = document.getElementById('modalRidsTable');
            if (employeeRids.length === 0) {
                const noDataMessage = employeesSelectedStartDate && employeesSelectedEndDate 
                    ? 'Nenhum RID encontrado para o período selecionado'
                    : 'Nenhum RID encontrado para este mês';
                tableBody.innerHTML = `<tr><td colspan="5" class="text-center py-8 text-gray-500">${noDataMessage}</td></tr>`;
            } else {
                tableBody.innerHTML = employeeRids.map(rid => `
                    <tr class="border-b border-gray-100 hover:bg-blue-50 cursor-pointer transition duration-200" onclick="showRidDetails(${rid.id})">
                        <td class="py-3 px-4 font-medium text-blue-600">${rid.number}</td>
                        <td class="py-3 px-4 max-w-xs">
                            <div class="truncate" title="${rid.description}">${rid.description}</div>
                        </td>
                        <td class="py-3 px-4">
                            <span class="px-2 py-1 text-xs rounded-full ${getPriorityColor(rid.priority)}">
                                ${rid.priority}
                            </span>
                        </td>
                        <td class="py-3 px-4">${rid.createdDate}</td>
                        <td class="py-3 px-4">
                            <span class="px-2 py-1 text-xs rounded-full ${getStatusColor(rid.status)}">
                                ${rid.status}
                            </span>
                        </td>
                    </tr>
                `).join('');
            }

            // Mostrar modal
            document.getElementById('employeeRidsModal').classList.remove('hidden');
        }

        // Fechar modal de RIDs do funcionário
        function closeEmployeeRidsModal() {
            document.getElementById('employeeRidsModal').classList.add('hidden');
        }

        // Mostrar detalhes do RID
        function showRidDetails(ridId) {
            const rid = rids.find(r => r.id === ridId);
            if (!rid) return;

            // Atualizar título do modal
            document.getElementById('ridDetailsTitle').textContent = `RID ${rid.number}`;
            document.getElementById('ridDetailsSubtitle').textContent = `Emitido por ${rid.employeeName} • ${rid.createdDate}`;

            // Criar conteúdo detalhado
            const content = document.getElementById('ridDetailsContent');
            content.innerHTML = `
                <div class="space-y-6">
                    <!-- Informações do Emitente -->
                    <div class="bg-gradient-to-r from-green-25 to-green-50 rounded-xl p-6 border border-green-100" style="background: linear-gradient(to right, #f0fdf4, #f7fee7);">
                        <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                            <div class="w-10 h-10 rounded-full flex items-center justify-center mr-4" style="background-color: #DCFCE7;">
                                <svg class="w-6 h-6" style="color: #16A34A;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                </svg>
                            </div>
                            Informações do Emitente
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-white rounded-lg p-4 border border-green-100">
                                <label class="block text-sm font-semibold text-green-600 mb-2">Nome Completo</label>
                                <p class="text-gray-900 font-medium">${rid.employeeName}</p>
                            </div>
                            <div class="bg-white rounded-lg p-4 border border-green-100">
                                <label class="block text-sm font-semibold text-green-600 mb-2">Setor</label>
                                <p class="text-gray-900 font-medium">${rid.employeeSector}</p>
                            </div>
                            ${rid.tipoContrato ? `
                            <div class="bg-white rounded-lg p-4 border border-green-100">
                                <label class="block text-sm font-semibold text-green-600 mb-2">Tipo de Contrato</label>
                                <p class="text-gray-900 font-medium">${rid.tipoContrato}</p>
                            </div>
                            ` : ''}
                            ${rid.unidade ? `
                            <div class="bg-white rounded-lg p-4 border border-green-100">
                                <label class="block text-sm font-semibold text-green-600 mb-2">Unidade</label>
                                <p class="text-gray-900 font-medium">${rid.unidade}</p>
                            </div>
                            ` : ''}
                        </div>
                    </div>

                    ${rid.incidenteDesvio ? `
                    <!-- Informações da Ocorrência -->
                    <div class="bg-gradient-to-r from-orange-25 to-orange-50 rounded-xl p-6 border border-orange-100" style="background: linear-gradient(to right, #fff7ed, #fef3c7);">
                        <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                            <div class="w-10 h-10 rounded-full flex items-center justify-center mr-4" style="background-color: #FED7AA;">
                                <svg class="w-6 h-6" style="color: #EA580C;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                                </svg>
                            </div>
                            Detalhes da Ocorrência
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-white rounded-lg p-4 border border-orange-100">
                                <label class="block text-sm font-semibold text-orange-600 mb-2">Tipo de Incidente/Desvio</label>
                                <p class="text-gray-900 font-medium">${rid.incidenteDesvio}</p>
                            </div>
                            ${rid.dataOcorrido ? `
                            <div class="bg-white rounded-lg p-4 border border-orange-100">
                                <label class="block text-sm font-semibold text-orange-600 mb-2">Data da Ocorrência</label>
                                <p class="text-gray-900 font-medium">${new Date(rid.dataOcorrido).toLocaleDateString('pt-BR')}</p>
                            </div>
                            ` : ''}
                            ${rid.localOcorrencia ? `
                            <div class="bg-white rounded-lg p-4 border border-orange-100 md:col-span-2">
                                <label class="block text-sm font-semibold text-orange-600 mb-2">Local da Ocorrência</label>
                                <p class="text-gray-900 font-medium">${rid.localOcorrencia}</p>
                            </div>
                            ` : ''}
                        </div>
                    </div>

                    <!-- Ação Imediata -->
                    <div class="bg-gradient-to-r from-purple-25 to-purple-50 rounded-xl p-6 border border-purple-100" style="background: linear-gradient(to right, #faf5ff, #f3e8ff);">
                        <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                            <div class="w-10 h-10 rounded-full flex items-center justify-center mr-4" style="background-color: #F3E8FF;">
                                <svg class="w-6 h-6" style="color: #9333EA;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                </svg>
                            </div>
                            Ação Imediata Tomada
                        </h3>
                        ${rid.acaoImediata ? `
                        <div class="bg-white rounded-lg p-4 border border-purple-100">
                            <label class="block text-sm font-semibold text-purple-600 mb-2">Descrição da Ação</label>
                            <p class="text-gray-900 font-medium leading-relaxed">${rid.acaoImediata}</p>
                        </div>
                        ` : ''}
                    </div>
                    ` : ''}

                    <!-- Descrição Completa -->
                    <div class="bg-gradient-to-r from-red-25 to-red-50 rounded-xl p-6 border border-red-100" style="background: linear-gradient(to right, #fef2f2, #fef7f7);">
                        <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                            <div class="w-10 h-10 rounded-full flex items-center justify-center mr-4" style="background-color: #FEE2E2;">
                                <svg class="w-6 h-6" style="color: #DC2626;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                            </div>
                            Descrição Detalhada do Problema
                        </h3>
                        <div class="bg-white rounded-lg p-6 border border-red-100 shadow-sm">
                            <p class="text-gray-900 leading-relaxed text-base font-medium">${rid.description}</p>
                        </div>
                    </div>

                ${currentUser && currentUser.type === 'admin' ? `
                <!-- Controle de Status e Prioridade -->
                <div class="mt-6 bg-blue-25 rounded-lg p-6 border border-blue-100" style="background: #f0f9ff;">
                    <h3 class="text-lg font-semibold text-gray-800 mb-6 flex items-center">
                        <div class="w-8 h-8 rounded-full flex items-center justify-center mr-3" style="background-color: #DBEAFE;">
                            <svg class="w-5 h-5" style="color: #2563EB;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                        </div>
                        Gerenciar Status e Prioridade do RID
                    </h3>
                    
                    <!-- Status -->
                    <div class="bg-white rounded-lg p-4 border border-blue-100 mb-4">
                        <h4 class="text-md font-semibold text-gray-800 mb-4 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            Controle de Status
                        </h4>
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <!-- Status Atual -->
                            <div class="text-center lg:text-left">
                                <label class="block text-sm font-semibold text-gray-700 mb-3">Status Atual</label>
                                <div class="flex justify-center lg:justify-start">
                                    <span class="inline-flex items-center px-4 py-2 text-sm font-medium rounded-full ${getStatusColor(rid.status)}">
                                        ${rid.status}
                                    </span>
                                </div>
                            </div>
                            
                            <!-- Novo Status -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-3">Alterar Para</label>
                                <select id="newRidStatus" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm font-medium">
                                    <option value="">Selecione o novo status</option>
                                    <option value="Pendente" ${rid.status === 'Pendente' ? 'disabled' : ''}>Pendente</option>
                                    <option value="Em Andamento" ${rid.status === 'Em Andamento' ? 'disabled' : ''}>Em Andamento</option>
                                    <option value="Concluído" ${rid.status === 'Concluído' ? 'disabled' : ''}>Concluído</option>
                                </select>
                            </div>
                            
                            <!-- Botão Status -->
                            <div class="flex items-end">
                                <!-- Espaço vazio para manter layout -->
                            </div>
                        </div>
                    </div>

                    <!-- Prioridade -->
                    <div class="bg-white rounded-lg p-4 border border-blue-100">
                        <h4 class="text-md font-semibold text-gray-800 mb-4 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                            </svg>
                            Controle de Prioridade
                        </h4>
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <!-- Prioridade Atual -->
                            <div class="text-center lg:text-left">
                                <label class="block text-sm font-semibold text-gray-700 mb-3">Prioridade Atual</label>
                                <div class="flex justify-center lg:justify-start">
                                    <span class="inline-flex items-center px-4 py-2 text-sm font-medium rounded-full ${getPriorityColor(rid.priority)}">
                                        ${rid.priority}
                                    </span>
                                </div>
                            </div>
                            
                            <!-- Nova Prioridade -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-3">Alterar Para</label>
                                <select id="newRidPriority" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-sm font-medium">
                                    <option value="">Selecione a nova prioridade</option>
                                    <option value="Baixa" ${rid.priority === 'Baixa' ? 'disabled' : ''}>Baixa</option>
                                    <option value="Média" ${rid.priority === 'Média' ? 'disabled' : ''}>Média</option>
                                    <option value="Alta" ${rid.priority === 'Alta' ? 'disabled' : ''}>Alta</option>
                                </select>
                            </div>
                            
                            <!-- Espaço vazio -->
                            <div class="flex items-end">
                                <!-- Espaço vazio para manter layout -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Botão Único para Atualizar Ambos -->
                    <div class="flex justify-end mt-4">
                        <button onclick="updateRidStatusAndPriority(${rid.id})" class="px-8 py-4 bg-green-600 hover:bg-green-700 text-white rounded-xl font-bold transition duration-200 transform hover:scale-105 shadow-lg">
                            Atualizar
                        </button>
                    </div>
                </div>
                ` : `
                <!-- Status Atual (Somente Visualização) -->
                <div class="mt-6 bg-gray-25 rounded-lg p-6 border border-gray-100" style="background: #f9fafb;">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <div class="w-8 h-8 rounded-full flex items-center justify-center mr-3" style="background-color: #F3F4F6;">
                            <svg class="w-5 h-5" style="color: #6B7280;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        Status do RID
                    </h3>
                    
                    <div class="bg-white rounded-lg p-4 border border-gray-100">
                        <div class="text-center">
                            <label class="block text-sm font-semibold text-gray-700 mb-3">Status Atual</label>
                            <span class="inline-flex items-center px-6 py-3 text-base font-medium rounded-full ${getStatusColor(rid.status)}">
                                ${rid.status}
                            </span>
                            <p class="text-sm text-gray-500 mt-3">Apenas administradores podem alterar o status dos RIDs</p>
                        </div>
                    </div>
                </div>
                `}

                <!-- Botões de Ação -->
                <div class="mt-8 flex justify-center pt-6 border-t-2 border-gray-200">
                    <button onclick="closeRidDetailsModal()" class="px-8 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-xl font-semibold transition duration-200 transform hover:scale-105 shadow-lg">
                        ← Fechar Detalhes
                    </button>
                </div>
            `;

            // Mostrar modal
            document.getElementById('ridDetailsModal').classList.remove('hidden');
        }

        // Fechar modal de detalhes do RID
        function closeRidDetailsModal() {
            document.getElementById('ridDetailsModal').classList.add('hidden');
        }

        // Função para atualizar status do RID
        function updateRidStatus(ridId) {
            const rid = rids.find(r => r.id === ridId);
            if (!rid) {
                alert('RID não encontrado!');
                return;
            }

            const newStatusSelect = document.getElementById('newRidStatus');
            const newStatus = newStatusSelect.value;

            if (!newStatus) {
                alert('Por favor, selecione um novo status.');
                return;
            }

            if (newStatus === rid.status) {
                alert('O status selecionado é o mesmo do atual.');
                return;
            }

            // Atualizar o status
            rid.status = newStatus;
            
            // Atualizar o status na tabela do modal "RIDs de tal funcionário" se estiver aberto
            const modalRidsTable = document.getElementById('modalRidsTable');
            if (modalRidsTable && !document.getElementById('employeeRidsModal').classList.contains('hidden')) {
                const rows = modalRidsTable.querySelectorAll('tr');
                rows.forEach(row => {
                    const ridNumberCell = row.querySelector('td:first-child');
                    if (ridNumberCell && ridNumberCell.textContent.trim() === rid.number) {
                        const statusCell = row.querySelector('td:last-child span');
                        if (statusCell) {
                            statusCell.className = `px-2 py-1 text-xs rounded-full ${getStatusColor(rid.status)}`;
                            statusCell.textContent = rid.status;
                        }
                    }
                });
            }
            
            // Atualizar dashboards
            if (currentUser && currentUser.type === 'admin') {
                loadAdminDashboard();
            } else if (currentUser && currentUser.type === 'employee') {
                loadEmployeeDashboard();
            }
            
            // Fechar modal de detalhes e voltar para a janela anterior
            closeRidDetailsModal();
            
            // Mostrar mensagem de sucesso
            alert(`✅ Status do RID ${rid.number} alterado com sucesso para: ${rid.status}`);
        }

        // Função para atualizar prioridade do RID
        function updateRidPriority(ridId) {
            const rid = rids.find(r => r.id === ridId);
            if (!rid) {
                alert('RID não encontrado!');
                return;
            }

            const newPrioritySelect = document.getElementById('newRidPriority');
            const newPriority = newPrioritySelect.value;

            if (!newPriority) {
                alert('Por favor, selecione uma nova prioridade.');
                return;
            }

            if (newPriority === rid.priority) {
                alert('A prioridade selecionada é a mesma da atual.');
                return;
            }

            // Atualizar a prioridade
            rid.priority = newPriority;
            
            // Atualizar a prioridade na tabela do modal "RIDs de tal funcionário" se estiver aberto
            const modalRidsTable = document.getElementById('modalRidsTable');
            if (modalRidsTable && !document.getElementById('employeeRidsModal').classList.contains('hidden')) {
                const rows = modalRidsTable.querySelectorAll('tr');
                rows.forEach(row => {
                    const ridNumberCell = row.querySelector('td:first-child');
                    if (ridNumberCell && ridNumberCell.textContent.trim() === rid.number) {
                        const priorityCell = row.querySelector('td:nth-child(3) span');
                        if (priorityCell) {
                            priorityCell.className = `px-2 py-1 text-xs rounded-full ${getPriorityColor(rid.priority)}`;
                            priorityCell.textContent = rid.priority;
                        }
                    }
                });
            }
            
            // Atualizar dashboards
            if (currentUser && currentUser.type === 'admin') {
                loadAdminDashboard();
            } else if (currentUser && currentUser.type === 'employee') {
                loadEmployeeDashboard();
            }
            
            // Fechar modal de detalhes e voltar para a janela anterior
            closeRidDetailsModal();
            
            // Mostrar mensagem de sucesso
            alert(`⚡ Prioridade do RID ${rid.number} alterada com sucesso para: ${rid.priority}`);
        }

        // Função para atualizar status e prioridade juntos
        function updateRidStatusAndPriority(ridId) {
            const rid = rids.find(r => r.id === ridId);
            if (!rid) {
                alert('RID não encontrado!');
                return;
            }

            const newStatusSelect = document.getElementById('newRidStatus');
            const newPrioritySelect = document.getElementById('newRidPriority');
            const newStatus = newStatusSelect.value;
            const newPriority = newPrioritySelect.value;

            // Verificar se pelo menos um campo foi alterado
            if (!newStatus && !newPriority) {
                alert('Por favor, selecione pelo menos um campo para atualizar (status ou prioridade).');
                return;
            }

            // Verificar se os valores são diferentes dos atuais
            const statusChanged = newStatus && newStatus !== rid.status;
            const priorityChanged = newPriority && newPriority !== rid.priority;

            if (!statusChanged && !priorityChanged) {
                alert('Os valores selecionados são os mesmos dos atuais. Nenhuma alteração foi feita.');
                return;
            }

            // Atualizar os campos que foram alterados
            let changedFields = [];
            
            if (statusChanged) {
                rid.status = newStatus;
                changedFields.push(`Status: ${newStatus}`);
            }
            
            if (priorityChanged) {
                rid.priority = newPriority;
                changedFields.push(`Prioridade: ${newPriority}`);
            }
            
            // Atualizar na tabela do modal "RIDs de tal funcionário" se estiver aberto
            const modalRidsTable = document.getElementById('modalRidsTable');
            if (modalRidsTable && !document.getElementById('employeeRidsModal').classList.contains('hidden')) {
                const rows = modalRidsTable.querySelectorAll('tr');
                rows.forEach(row => {
                    const ridNumberCell = row.querySelector('td:first-child');
                    if (ridNumberCell && ridNumberCell.textContent.trim() === rid.number) {
                        if (statusChanged) {
                            const statusCell = row.querySelector('td:last-child span');
                            if (statusCell) {
                                statusCell.className = `px-2 py-1 text-xs rounded-full ${getStatusColor(rid.status)}`;
                                statusCell.textContent = rid.status;
                            }
                        }
                        if (priorityChanged) {
                            const priorityCell = row.querySelector('td:nth-child(3) span');
                            if (priorityCell) {
                                priorityCell.className = `px-2 py-1 text-xs rounded-full ${getPriorityColor(rid.priority)}`;
                                priorityCell.textContent = rid.priority;
                            }
                        }
                    }
                });
            }
            
            // Atualizar dashboards
            if (currentUser && currentUser.type === 'admin') {
                loadAdminDashboard();
            } else if (currentUser && currentUser.type === 'employee') {
                loadEmployeeDashboard();
            }
            
            // Fechar modal de detalhes e voltar para a janela anterior
            closeRidDetailsModal();
            
            // Mostrar mensagem de sucesso
            alert(`✅ RID ${rid.number} atualizado com sucesso!\n\n📝 Alterações realizadas:\n• ${changedFields.join('\n• ')}`);
        }

        // Função para mostrar modal de criar RID
        function showCreateRidModal() {
            document.getElementById('createRidModal').classList.remove('hidden');
        }

        // Função para fechar modal de criar RID
        function closeCreateRidModal() {
            document.getElementById('createRidModal').classList.add('hidden');
            document.getElementById('createRidForm').reset();
        }

        // Função para criar RID pelo admin ou funcionário
        function createAdminRid(event) {
            event.preventDefault();
            
            const formData = {
                emitente: document.getElementById('adminRidEmitente').value,
                tipoContrato: document.getElementById('adminRidTipoContrato').value,
                unidade: document.getElementById('adminRidUnidade').value,
                setorEmitente: document.getElementById('adminRidSetorEmitente').value,
                dataOcorrido: document.getElementById('adminRidData').value,
                incidenteDesvio: document.getElementById('adminRidIncidenteDesvio').value,
                localOcorrencia: document.getElementById('adminRidLocalOcorrencia').value,
                descricaoOcorrencia: document.getElementById('adminRidDescricaoOcorrencia').value,
                acaoImediata: document.getElementById('adminRidAcaoImediata').value,
                prioridade: document.getElementById('adminRidPrioridade').value,
                status: document.getElementById('adminRidStatus').value
            };

            // Determinar o employeeId correto baseado no emitente
            let employeeId = null;
            let employeeName = formData.emitente;
            let employeeSector = formData.setorEmitente;

            // Se o usuário atual é funcionário, usar seus dados
            if (currentUser.type === 'employee') {
                employeeId = currentUser.id;
                employeeName = currentUser.name;
                employeeSector = currentUser.sector;
            } else {
                // Se é admin, tentar encontrar o funcionário pelo nome do emitente
                const foundEmployee = employees.find(emp => 
                    emp.name.toLowerCase() === formData.emitente.toLowerCase() ||
                    emp.name.toLowerCase().includes(formData.emitente.toLowerCase()) ||
                    formData.emitente.toLowerCase().includes(emp.name.toLowerCase())
                );
                
                if (foundEmployee) {
                    employeeId = foundEmployee.id;
                    employeeName = foundEmployee.name;
                    employeeSector = foundEmployee.sector;
                }
            }

            const rid = {
                id: ridCounter++,
                number: `RID-${String(ridCounter - 1).padStart(4, '0')}`,
                employeeId: employeeId,
                employeeName: employeeName,
                employeeSector: employeeSector,
                description: formData.descricaoOcorrencia,
                priority: formData.prioridade,
                status: formData.status === 'corrigido' ? 'Concluído' : 'Pendente',
                createdAt: new Date().toISOString(),
                createdDate: new Date(formData.dataOcorrido).toLocaleDateString('pt-BR'),
                // Campos específicos do admin
                emitente: formData.emitente,
                tipoContrato: formData.tipoContrato,
                unidade: formData.unidade,
                setorEmitente: formData.setorEmitente,
                dataOcorrido: formData.dataOcorrido,
                incidenteDesvio: formData.incidenteDesvio,
                localOcorrencia: formData.localOcorrencia,
                acaoImediata: formData.acaoImediata
            };

            rids.push(rid);
            closeCreateRidModal();
            
            // Atualizar dashboard apropriado
            if (currentUser.type === 'admin') {
                loadAdminDashboard();
            } else {
                loadEmployeeDashboard();
            }
            
            let successMessage = `RID criado com sucesso! Número: ${rid.number}`;
            if (employeeId) {
                successMessage += `\n\n✅ RID vinculado ao funcionário: ${employeeName}`;
                successMessage += `\n📊 Aparecerá na lista de funcionários do painel administrativo`;
            } else {
                successMessage += `\n\n⚠️ RID criado sem vínculo específico com funcionário cadastrado`;
            }
            
            alert(successMessage);
        }

        // Carregar dashboard do funcionário
        function loadEmployeeDashboard() {
            document.getElementById('employeeWelcome').textContent = `Bem-vindo, ${currentUser.name}`;
            
            const myRids = rids.filter(rid => rid.employeeId === currentUser.id);
            document.getElementById('myRidsCount').textContent = myRids.length;
            
            const pending = myRids.filter(rid => rid.status === 'Pendente').length;
            const inProgress = myRids.filter(rid => rid.status === 'Em Andamento').length;
            const completed = myRids.filter(rid => rid.status === 'Concluído').length;
            
            document.getElementById('pendingCount').textContent = pending;
            document.getElementById('inProgressCount').textContent = inProgress;
            document.getElementById('completedCount').textContent = completed;

            const tableBody = document.getElementById('employeeRidsTable');
            if (myRids.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="5" class="text-center py-8 text-gray-500">Nenhum RID encontrado</td></tr>';
            } else {
                tableBody.innerHTML = myRids.map(rid => `
                    <tr class="border-b border-gray-100 hover:bg-blue-50 cursor-pointer transition duration-200" onclick="showRidDetails(${rid.id})">
                        <td class="py-3 px-4 font-medium text-blue-600">${rid.number}</td>
                        <td class="py-3 px-4 max-w-xs truncate" title="${rid.description}">${rid.description}</td>
                        <td class="py-3 px-4">
                            <span class="px-2 py-1 text-xs rounded-full ${getPriorityColor(rid.priority)}">
                                ${rid.priority}
                            </span>
                        </td>
                        <td class="py-3 px-4">${rid.createdDate}</td>
                        <td class="py-3 px-4">
                            <span class="px-2 py-1 text-xs rounded-full ${getStatusColor(rid.status)}">
                                ${rid.status}
                            </span>
                        </td>
                    </tr>
                `).join('');
            }
        }

        // Funções auxiliares
        function getStatusColor(status) {
            switch(status) {
                case 'Pendente': return 'bg-yellow-100 text-yellow-800';
                case 'Em Andamento': return 'bg-blue-100 text-blue-800';
                case 'Concluído': return 'bg-green-100 text-green-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function getPriorityColor(priority) {
            switch(priority) {
                case 'Baixa': return 'bg-green-100 text-green-800';
                case 'Média': return 'bg-yellow-100 text-yellow-800';
                case 'Alta': return 'bg-orange-100 text-orange-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.classList.remove('hidden');
            setTimeout(() => element.classList.add('hidden'), 5000);
        }

        function showSuccess(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.classList.remove('hidden');
            setTimeout(() => element.classList.add('hidden'), 5000);
        }

        function logout() {
            currentUser = null;
            showLogin();
        }

        // Função para emitir relatório completo
        function emitirRelatorio() {
            // Filtrar RIDs baseado no período selecionado nos filtros dos funcionários
            let filteredRids = rids;
            let periodText = 'todos os períodos';
            
            // Verificar se há filtros de data aplicados na seção de funcionários
            if (employeesSelectedStartDate || employeesSelectedEndDate) {
                filteredRids = rids.filter(rid => {
                    const ridDate = new Date(rid.createdAt);
                    
                    // Se apenas data inicial foi selecionada, mostrar RIDs a partir dessa data
                    if (employeesSelectedStartDate && !employeesSelectedEndDate) {
                        return ridDate >= employeesSelectedStartDate;
                    }
                    
                    // Se apenas data final foi selecionada, mostrar RIDs até essa data
                    if (!employeesSelectedStartDate && employeesSelectedEndDate) {
                        return ridDate <= employeesSelectedEndDate;
                    }
                    
                    // Se ambas as datas foram selecionadas, mostrar RIDs no período
                    if (employeesSelectedStartDate && employeesSelectedEndDate) {
                        return ridDate >= employeesSelectedStartDate && ridDate <= employeesSelectedEndDate;
                    }
                    
                    return true;
                });
                
                // Definir texto do período para o nome do arquivo
                if (employeesSelectedStartDate && employeesSelectedEndDate) {
                    const startStr = employeesSelectedStartDate.toLocaleDateString('pt-BR').replace(/\//g, '-');
                    const endStr = employeesSelectedEndDate.toLocaleDateString('pt-BR').replace(/\//g, '-');
                    periodText = `${startStr}_a_${endStr}`;
                } else if (employeesSelectedStartDate && !employeesSelectedEndDate) {
                    const startStr = employeesSelectedStartDate.toLocaleDateString('pt-BR').replace(/\//g, '-');
                    periodText = `desde_${startStr}`;
                } else if (!employeesSelectedStartDate && employeesSelectedEndDate) {
                    const endStr = employeesSelectedEndDate.toLocaleDateString('pt-BR').replace(/\//g, '-');
                    periodText = `ate_${endStr}`;
                }
            } else {
                // Se não há filtro de data, usar RIDs do mês padrão (outubro 2025)
                const defaultMonth = 9; // Outubro (0-indexado)
                const defaultYear = 2025;
                filteredRids = rids.filter(rid => {
                    const ridDate = new Date(rid.createdAt);
                    return ridDate.getMonth() === defaultMonth && ridDate.getFullYear() === defaultYear;
                });
                periodText = 'outubro_2025';
            }
            
            // Verificar se há RIDs no período selecionado
            if (filteredRids.length === 0) {
                alert('❌ Nenhum RID encontrado para o período selecionado!\n\nPor favor, ajuste os filtros de data e tente novamente.');
                return;
            }
            
            // Calcular estatísticas dos RIDs filtrados
            const totalRids = filteredRids.length;
            const pendingRids = filteredRids.filter(rid => rid.status === 'Pendente').length;
            const inProgressRids = filteredRids.filter(rid => rid.status === 'Em Andamento').length;
            const completedRids = filteredRids.filter(rid => rid.status === 'Concluído').length;
            
            // Criar dados do relatório CSV com as colunas específicas solicitadas
            const reportData = [];
            
            // Cabeçalho com as colunas específicas
            reportData.push([
                'Unidade',
                'RID nº',
                'Data da emissão',
                'Emitente',
                'Funcionário / Terceiro / Visitante',
                'Setor / Empresa do emitente',
                'Local do incidente ou desvio',
                'Descrição',
                'Classificação de risco',
                'Ação imediata',
                'Data de conclusão',
                'Status'
            ]);
            
            // Adicionar dados de cada RID filtrado
            filteredRids.forEach(rid => {
                // Calcular data de conclusão (se concluído, usar data de criação; se não, mostrar traço)
                const dataConclusao = rid.status === 'Concluído' ? rid.createdDate : '-';
                
                reportData.push([
                    rid.unidade || 'Não informado',
                    rid.number,
                    rid.createdDate,
                    rid.emitente || rid.employeeName,
                    rid.tipoContrato || 'Funcionário',
                    rid.setorEmitente || rid.employeeSector,
                    rid.localOcorrencia || 'Não informado',
                    rid.description,
                    rid.priority,
                    rid.acaoImediata || 'Não informado',
                    dataConclusao,
                    rid.status
                ]);
            });
            
            // Converter para TXT com asterisco como delimitador
            const csvContent = reportData.map(row => 
                row.map(field => `${field}`).join('*')
            ).join('\n');
            
            // Criar nome do arquivo com o período
            const fileName = `relatorio_rids_${periodText}.txt`;
            
            // Criar e baixar arquivo
            const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/plain;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', fileName);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Mostrar mensagem de sucesso
            alert(`✅ Relatório gerado com sucesso!\n\n📊 Resumo do período selecionado:\n• Total de RIDs: ${totalRids}\n• Pendentes: ${pendingRids}\n• Em Andamento: ${inProgressRids}\n• Concluídos: ${completedRids}\n\n📁 Arquivo baixado: ${fileName}`);
        }

        // Função para baixar dados dos funcionários
        function downloadEmployeesData() {
            // Criar dados CSV dos funcionários com suas estatísticas de RIDs
            const csvData = [];
            csvData.push(['Nome', 'CPF', 'Setor', 'Total de RIDs', 'RIDs Pendentes', 'RIDs em Andamento', 'RIDs Concluídos', 'Data de Cadastro']);
            
            employees.forEach(employee => {
                const employeeRids = rids.filter(rid => rid.employeeId === employee.id);
                const pendingRids = employeeRids.filter(rid => rid.status === 'Pendente').length;
                const inProgressRids = employeeRids.filter(rid => rid.status === 'Em Andamento').length;
                const completedRids = employeeRids.filter(rid => rid.status === 'Concluído').length;
                const createdDate = new Date(employee.createdAt).toLocaleDateString('pt-BR');
                
                csvData.push([
                    employee.name,
                    formatCpf(employee.cpf),
                    employee.sector,
                    employeeRids.length,
                    pendingRids,
                    inProgressRids,
                    completedRids,
                    createdDate
                ]);
            });
            
            // Converter para CSV
            const csvContent = csvData.map(row => 
                row.map(field => `"${field}"`).join(',')
            ).join('\n');
            
            // Criar e baixar arquivo
            const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `funcionarios_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Funções para controlar os menus dropdown
        function toggleAdminMenu() {
            const menu = document.getElementById('adminDropdownMenu');
            menu.classList.toggle('hidden');
        }

        function toggleEmployeeMenu() {
            const menu = document.getElementById('employeeDropdownMenu');
            menu.classList.toggle('hidden');
        }

        // Função para abrir planilha de relatório
        function abrirPlanilhaRelatorio() {
            // Mostrar modal
            document.getElementById('planilhaRelatorioModal').classList.remove('hidden');
            
            // Carregar dados na planilha
            carregarDadosPlanilha();
        }

        // Função para fechar planilha de relatório
        function fecharPlanilhaRelatorio() {
            document.getElementById('planilhaRelatorioModal').classList.add('hidden');
        }

        // Função para carregar dados na planilha
        function carregarDadosPlanilha() {
            const tbody = document.getElementById('planilhaRelatorioBody');
            const totalElement = document.getElementById('totalRidsRelatorio');
            
            // Filtrar RIDs baseado no período selecionado nos filtros dos funcionários
            let filteredRids = rids;
            
            if (employeesSelectedStartDate || employeesSelectedEndDate) {
                filteredRids = rids.filter(rid => {
                    const ridDate = new Date(rid.createdAt);
                    
                    // Se apenas data inicial foi selecionada, mostrar RIDs a partir dessa data
                    if (employeesSelectedStartDate && !employeesSelectedEndDate) {
                        return ridDate >= employeesSelectedStartDate;
                    }
                    
                    // Se apenas data final foi selecionada, mostrar RIDs até essa data
                    if (!employeesSelectedStartDate && employeesSelectedEndDate) {
                        return ridDate <= employeesSelectedEndDate;
                    }
                    
                    // Se ambas as datas foram selecionadas, mostrar RIDs no período
                    if (employeesSelectedStartDate && employeesSelectedEndDate) {
                        return ridDate >= employeesSelectedStartDate && ridDate <= employeesSelectedEndDate;
                    }
                    
                    return true;
                });
            } else {
                // Se não há filtro de data, mostrar RIDs do mês padrão (outubro 2025)
                const defaultMonth = 9; // Outubro (0-indexado)
                const defaultYear = 2025;
                filteredRids = rids.filter(rid => {
                    const ridDate = new Date(rid.createdAt);
                    return ridDate.getMonth() === defaultMonth && ridDate.getFullYear() === defaultYear;
                });
            }
            
            const allRids = filteredRids;
            
            // Atualizar contador
            totalElement.textContent = allRids.length;
            
            // Limpar tabela
            tbody.innerHTML = '';
            
            // Preencher dados
            allRids.forEach(rid => {
                const row = document.createElement('tr');
                
                // Definir cores baseadas no status
                let statusClass = '';
                if (rid.status === 'Pendente') {
                    statusClass = 'bg-red-100';
                } else if (rid.status === 'Concluído') {
                    statusClass = 'bg-green-100';
                } else if (rid.status === 'Em Andamento') {
                    statusClass = 'bg-blue-100';
                }
                
                row.className = `hover:bg-gray-50 ${statusClass}`;
                
                // Calcular data de conclusão
                const dataConclusao = rid.status === 'Concluído' ? rid.createdDate : '';
                
                row.innerHTML = `
                    <!-- Todos os campos são EDITÁVEIS -->
                    <td class="border border-gray-300 px-3 py-2 text-sm hover:bg-blue-50 cursor-text break-words whitespace-normal" 
                        contenteditable="true" 
                        title="Campo editável - clique para editar"
                        onblur="updateRidField(${rid.id}, 'unidade', this.textContent)">${rid.unidade || ''}</td>
                    <td class="border border-gray-300 px-3 py-2 text-sm font-medium hover:bg-blue-50 cursor-text break-words whitespace-normal" 
                        contenteditable="true" 
                        title="Campo editável - clique para editar"
                        onblur="updateRidField(${rid.id}, 'number', this.textContent)">${rid.number}</td>
                    <td class="border border-gray-300 px-3 py-2 text-sm hover:bg-blue-50 cursor-text break-words whitespace-normal" 
                        contenteditable="true" 
                        title="Campo editável - clique para editar"
                        onblur="updateRidField(${rid.id}, 'createdDate', this.textContent)">${rid.createdDate}</td>
                    <td class="border border-gray-300 px-3 py-2 text-sm hover:bg-blue-50 cursor-text break-words whitespace-normal" 
                        contenteditable="true" 
                        title="Campo editável - clique para editar"
                        onblur="updateRidField(${rid.id}, 'emitente', this.textContent)">${rid.emitente || rid.employeeName}</td>
                    <td class="border border-gray-300 px-3 py-2 text-sm hover:bg-blue-50 cursor-text break-words whitespace-normal" 
                        contenteditable="true" 
                        title="Campo editável - clique para editar"
                        onblur="updateRidField(${rid.id}, 'tipoContrato', this.textContent)">${rid.tipoContrato || 'Funcionário'}</td>
                    <td class="border border-gray-300 px-3 py-2 text-sm hover:bg-blue-50 cursor-text break-words whitespace-normal" 
                        contenteditable="true" 
                        title="Campo editável - clique para editar"
                        onblur="updateRidField(${rid.id}, 'setorEmitente', this.textContent)">${rid.setorEmitente || rid.employeeSector}</td>
                    <td class="border border-gray-300 px-3 py-2 text-sm hover:bg-blue-50 cursor-text break-words whitespace-normal" 
                        contenteditable="true" 
                        title="Campo editável - clique para editar"
                        onblur="updateRidField(${rid.id}, 'localOcorrencia', this.textContent)">${rid.localOcorrencia || ''}</td>
                    <td class="border border-gray-300 px-3 py-2 text-sm hover:bg-blue-50 cursor-text break-words whitespace-normal" 
                        contenteditable="true" 
                        title="Campo editável - clique para editar"
                        onblur="updateRidField(${rid.id}, 'incidenteDesvio', this.textContent)">${rid.incidenteDesvio || ''}</td>
                    <td class="border border-gray-300 px-3 py-2 text-sm hover:bg-blue-50 cursor-text break-words whitespace-normal" 
                        contenteditable="true" 
                        title="Campo editável - clique para editar"
                        onblur="updateRidField(${rid.id}, 'origemDeteccao', this.textContent)">${rid.origemDeteccao || ''}</td>
                    <td class="border border-gray-300 px-3 py-2 text-sm hover:bg-blue-50 cursor-text break-words whitespace-normal" 
                        contenteditable="true" 
                        title="Campo editável - clique para editar"
                        onblur="updateRidField(${rid.id}, 'description', this.textContent)">${rid.description}</td>
                    <td class="border border-gray-300 px-3 py-2 text-sm hover:bg-blue-50 cursor-text break-words whitespace-normal" 
                        contenteditable="true" 
                        title="Campo editável - clique para editar"
                        onblur="updateRidField(${rid.id}, 'priority', this.textContent)">${rid.priority}</td>
                    <td class="border border-gray-300 px-3 py-2 text-sm hover:bg-blue-50 cursor-text break-words whitespace-normal" 
                        contenteditable="true" 
                        title="Campo editável - clique para editar"
                        onblur="updateRidField(${rid.id}, 'acaoImediata', this.textContent)">${rid.acaoImediata || ''}</td>
                    <td class="border border-gray-300 px-3 py-2 text-sm hover:bg-blue-50 cursor-text break-words whitespace-normal" 
                        contenteditable="true" 
                        title="Campo editável - clique para editar"
                        onblur="updateRidField(${rid.id}, 'acoesCorretivas', this.textContent)">${rid.acoesCorretivas || ''}</td>
                    <td class="border border-gray-300 px-3 py-2 text-sm hover:bg-blue-50 cursor-text break-words whitespace-normal" 
                        contenteditable="true" 
                        title="Campo editável - clique para editar"
                        onblur="updateRidField(${rid.id}, 'responsavelAcoes', this.textContent)">${rid.responsavelAcoes || ''}</td>
                    <td class="border border-gray-300 px-3 py-2 text-sm hover:bg-blue-50 cursor-text break-words whitespace-normal" 
                        contenteditable="true" 
                        title="Campo editável - clique para editar"
                        onblur="updateRidField(${rid.id}, 'prazoConclusao', this.textContent)">${rid.prazoConclusao || ''}</td>
                    <td class="border border-gray-300 px-3 py-2 text-sm hover:bg-blue-50 cursor-text break-words whitespace-normal" 
                        contenteditable="true" 
                        title="Campo editável - clique para editar"
                        onblur="updateRidField(${rid.id}, 'dataConclusao', this.textContent)">${dataConclusao}</td>
                    <td class="border border-gray-300 px-3 py-2 text-sm hover:bg-blue-50 cursor-text break-words whitespace-normal" 
                        contenteditable="true" 
                        title="Campo editável - clique para editar"
                        onblur="updateRidField(${rid.id}, 'status', this.textContent)">${rid.status}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Função para atualizar campo do RID
        function updateRidField(ridId, field, value) {
            const rid = rids.find(r => r.id === ridId);
            if (!rid) return;
            
            // Atualizar o campo
            rid[field] = value;
            
            // Se o campo for emitente, atualizar também employeeName para compatibilidade
            if (field === 'emitente') {
                rid.employeeName = value;
            }
            
            // Se o campo for setorEmitente, atualizar também employeeSector para compatibilidade
            if (field === 'setorEmitente') {
                rid.employeeSector = value;
            }
            
            // Atualizar dashboards se necessário
            if (currentUser && currentUser.type === 'admin') {
                // Atualizar métricas do dashboard admin
                const pendingCount = rids.filter(rid => rid.status === 'Pendente').length;
                const resolvedCount = rids.filter(rid => rid.status === 'Concluído').length;
                document.getElementById('pendingRids').textContent = pendingCount;
                document.getElementById('resolvedRids').textContent = resolvedCount;
            }
            
            // Mostrar feedback visual
            const cell = event.target.closest('td');
            if (cell) {
                cell.style.backgroundColor = '#dcfce7';
                setTimeout(() => {
                    cell.style.backgroundColor = '';
                }, 1000);
            }
        }

        // Função para salvar alterações da planilha
        function salvarAlteracoesPlanilha() {
            // Mostrar mensagem de confirmação
            const totalRids = rids.length;
            const confirmMessage = `💾 Salvar todas as alterações feitas na planilha?\n\n📊 Total de RIDs: ${totalRids}\n\n✅ As alterações serão aplicadas permanentemente aos dados.`;
            
            if (confirm(confirmMessage)) {
                // Simular salvamento (os dados já estão sendo atualizados em tempo real)
                // Aqui você poderia adicionar lógica para salvar no servidor
                
                // Mostrar feedback visual
                const saveButton = event.target.closest('button');
                const originalBg = saveButton.className;
                
                // Mudar cor temporariamente para indicar salvamento
                saveButton.className = saveButton.className.replace('bg-green-600', 'bg-emerald-500').replace('hover:bg-green-700', 'hover:bg-emerald-600');
                
                // Mostrar mensagem de sucesso
                setTimeout(() => {
                    alert(`✅ Alterações salvas com sucesso!\n\n📊 ${totalRids} RIDs atualizados\n⏰ ${new Date().toLocaleString('pt-BR')}`);
                    
                    // Restaurar cor original
                    saveButton.className = originalBg;
                }, 500);
            }
        }

        // Função para imprimir planilha
        function imprimirPlanilha() {
            // Filtrar RIDs baseado no período selecionado nos filtros dos funcionários
            let filteredRids = rids;
            
            if (employeesSelectedStartDate || employeesSelectedEndDate) {
                filteredRids = rids.filter(rid => {
                    const ridDate = new Date(rid.createdAt);
                    
                    if (employeesSelectedStartDate && !employeesSelectedEndDate) {
                        return ridDate >= employeesSelectedStartDate;
                    }
                    
                    if (!employeesSelectedStartDate && employeesSelectedEndDate) {
                        return ridDate <= employeesSelectedEndDate;
                    }
                    
                    if (employeesSelectedStartDate && employeesSelectedEndDate) {
                        return ridDate >= employeesSelectedStartDate && ridDate <= employeesSelectedEndDate;
                    }
                    
                    return true;
                });
            } else {
                // Se não há filtro de data, mostrar RIDs do mês padrão (outubro 2025)
                const defaultMonth = 9; // Outubro (0-indexado)
                const defaultYear = 2025;
                filteredRids = rids.filter(rid => {
                    const ridDate = new Date(rid.createdAt);
                    return ridDate.getMonth() === defaultMonth && ridDate.getFullYear() === defaultYear;
                });
            }
            
            // Criar uma nova janela para impressão
            const printWindow = window.open('', '_blank');
            
            // Criar conteúdo HTML para impressão
            const printContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>Relatório de RIDs - ${new Date().toLocaleDateString('pt-BR')}</title>
                    <style>
                        body {
                            font-family: Arial, sans-serif;
                            font-size: 10px;
                            margin: 20px;
                            color: #333;
                        }
                        .header {
                            text-align: center;
                            margin-bottom: 30px;
                            border-bottom: 2px solid #333;
                            padding-bottom: 15px;
                        }
                        .header h1 {
                            margin: 0;
                            font-size: 18px;
                            color: #1f2937;
                        }
                        .header p {
                            margin: 5px 0;
                            font-size: 12px;
                            color: #6b7280;
                        }

                        table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-top: 20px;
                            font-size: 8px;
                        }
                        th, td {
                            border: 1px solid #d1d5db;
                            padding: 4px;
                            text-align: left;
                            vertical-align: top;
                        }
                        th {
                            background-color: #f3f4f6;
                            font-weight: bold;
                            font-size: 9px;
                        }
                        .status-pendente { background-color: #fef3c7; }
                        .status-andamento { background-color: #dbeafe; }
                        .status-concluido { background-color: #dcfce7; }
                        .priority-alta { color: #dc2626; font-weight: bold; }
                        .priority-media { color: #d97706; }
                        .priority-baixa { color: #16a34a; }
                        .footer {
                            margin-top: 30px;
                            text-align: center;
                            font-size: 8px;
                            color: #6b7280;
                            border-top: 1px solid #d1d5db;
                            padding-top: 10px;
                        }
                        @media print {
                            body { margin: 10px; }
                            .header { page-break-after: avoid; }
                            table { page-break-inside: auto; }
                            tr { page-break-inside: avoid; page-break-after: auto; }
                            thead { display: table-header-group; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; position: relative;">
                            <img src="https://www.jdemito.com.br/wp-content/themes/jdemito/img/logo.png" alt="Grupo J Demito" style="height: 60px;" onerror="this.style.display='none';">
                            <div style="position: absolute; left: 50%; transform: translateX(-50%); text-align: center;">
                                <h1 style="margin: 0; font-size: 20px; color: #1f2937;">Grupo J Demito</h1>
                                <h2 style="margin: 5px 0; font-size: 16px; color: #4b5563;">Relatório de RIDs - Sistema RID</h2>
                            </div>
                            <div style="width: 60px;"></div>
                        </div>
                        <p>Data de Geração: ${new Date().toLocaleDateString('pt-BR')} às ${new Date().toLocaleTimeString('pt-BR')}</p>
                        <p>Total de Registros: ${filteredRids.length} RIDs</p>
                    </div>
                    

                    
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 5%;">Unidade</th>
                                <th style="width: 5%;">RID nº</th>
                                <th style="width: 6%;">Data emissão</th>
                                <th style="width: 8%;">Emitente</th>
                                <th style="width: 8%;">Func/Terc/Visit</th>
                                <th style="width: 8%;">Setor/Empresa</th>
                                <th style="width: 10%;">Local incidente</th>
                                <th style="width: 8%;">Gênese incidente</th>
                                <th style="width: 8%;">Origem detecção</th>
                                <th style="width: 15%;">Descrição</th>
                                <th style="width: 6%;">Class. risco</th>
                                <th style="width: 10%;">Ação imediata</th>
                                <th style="width: 10%;">Ações corretivas</th>
                                <th style="width: 8%;">Responsável</th>
                                <th style="width: 6%;">Prazo conclusão</th>
                                <th style="width: 6%;">Data conclusão</th>
                                <th style="width: 5%;">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${filteredRids.map(rid => {
                                const statusClass = rid.status === 'Pendente' ? 'status-pendente' : 
                                                  rid.status === 'Em Andamento' ? 'status-andamento' : 'status-concluido';
                                const priorityClass = rid.priority === 'Alta' ? 'priority-alta' : 
                                                     rid.priority === 'Média' ? 'priority-media' : 'priority-baixa';
                                
                                const dataConclusao = rid.status === 'Concluído' ? rid.createdDate : '';
                                
                                return `
                                    <tr class="${statusClass}">
                                        <td>${rid.unidade || ''}</td>
                                        <td><strong>${rid.number}</strong></td>
                                        <td>${rid.createdDate}</td>
                                        <td>${rid.emitente || rid.employeeName}</td>
                                        <td>${rid.tipoContrato || 'Funcionário'}</td>
                                        <td>${rid.setorEmitente || rid.employeeSector}</td>
                                        <td>${rid.localOcorrencia || ''}</td>
                                        <td>${rid.incidenteDesvio || ''}</td>
                                        <td>${rid.origemDeteccao || ''}</td>
                                        <td>${rid.description}</td>
                                        <td class="${priorityClass}">${rid.priority}</td>
                                        <td>${rid.acaoImediata || ''}</td>
                                        <td>${rid.acoesCorretivas || ''}</td>
                                        <td>${rid.responsavelAcoes || ''}</td>
                                        <td>${rid.prazoConclusao || ''}</td>
                                        <td>${dataConclusao}</td>
                                        <td><strong>${rid.status}</strong></td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                    
                    <div class="footer">
                        <p>Sistema RID - Relatório gerado automaticamente</p>
                        <p>Este documento contém informações confidenciais da empresa</p>
                    </div>
                </body>
                </html>
            `;
            
            // Escrever conteúdo na nova janela
            printWindow.document.write(printContent);
            printWindow.document.close();
            
            // Aguardar carregamento e imprimir
            printWindow.onload = function() {
                setTimeout(() => {
                    printWindow.print();
                    printWindow.close();
                }, 500);
            };
            
            // Determinar período para mensagem
            let periodMessage = 'outubro de 2025';
            if (employeesSelectedStartDate && employeesSelectedEndDate) {
                const startStr = employeesSelectedStartDate.toLocaleDateString('pt-BR');
                const endStr = employeesSelectedEndDate.toLocaleDateString('pt-BR');
                periodMessage = `${startStr} a ${endStr}`;
            } else if (employeesSelectedStartDate && !employeesSelectedEndDate) {
                const startStr = employeesSelectedStartDate.toLocaleDateString('pt-BR');
                periodMessage = `desde ${startStr}`;
            } else if (!employeesSelectedStartDate && employeesSelectedEndDate) {
                const endStr = employeesSelectedEndDate.toLocaleDateString('pt-BR');
                periodMessage = `até ${endStr}`;
            }
            
            // Mostrar mensagem de confirmação
            alert(`🖨️ Preparando impressão da planilha!\n\n📅 Período: ${periodMessage}\n📊 ${filteredRids.length} RIDs serão impressos\n\n✅ A janela de impressão será aberta automaticamente`);
        }

        // Função para exportar planilha para Excel
        function exportarPlanilhaExcel() {
            // Filtrar RIDs baseado no período selecionado nos filtros dos funcionários
            let filteredRids = rids;
            
            if (employeesSelectedStartDate || employeesSelectedEndDate) {
                filteredRids = rids.filter(rid => {
                    const ridDate = new Date(rid.createdAt);
                    
                    if (employeesSelectedStartDate && !employeesSelectedEndDate) {
                        return ridDate >= employeesSelectedStartDate;
                    }
                    
                    if (!employeesSelectedStartDate && employeesSelectedEndDate) {
                        return ridDate <= employeesSelectedEndDate;
                    }
                    
                    if (employeesSelectedStartDate && employeesSelectedEndDate) {
                        return ridDate >= employeesSelectedStartDate && ridDate <= employeesSelectedEndDate;
                    }
                    
                    return true;
                });
            } else {
                // Se não há filtro de data, mostrar RIDs do mês padrão (outubro 2025)
                const defaultMonth = 9; // Outubro (0-indexado)
                const defaultYear = 2025;
                filteredRids = rids.filter(rid => {
                    const ridDate = new Date(rid.createdAt);
                    return ridDate.getMonth() === defaultMonth && ridDate.getFullYear() === defaultYear;
                });
            }
            
            // Criar dados CSV com todas as colunas
            const csvData = [];
            
            // Cabeçalho
            csvData.push([
                'Unidade',
                'RID nº',
                'Data da emissão',
                'Emitente',
                'Funcionário / Terceiro / Visitante',
                'Setor / Empresa do emitente',
                'Local do incidente ou desvio',
                'Gênese do incidente ou desvio',
                'Origem da detecção',
                'Descrição',
                'Classificação de risco',
                'Ação imediata',
                'Ações corretivas',
                'Responsável pelas ações',
                'Prazo para conclusão',
                'Data de conclusão',
                'Status'
            ]);
            
            // Dados dos RIDs filtrados
            filteredRids.forEach(rid => {
                const dataConclusao = rid.status === 'Concluído' ? rid.createdDate : '';
                
                csvData.push([
                    rid.unidade || '',
                    rid.number,
                    rid.createdDate,
                    rid.emitente || rid.employeeName,
                    rid.tipoContrato || 'Funcionário',
                    rid.setorEmitente || rid.employeeSector,
                    rid.localOcorrencia || '',
                    rid.incidenteDesvio || '',
                    rid.origemDeteccao || '',
                    rid.description,
                    rid.priority,
                    rid.acaoImediata || '',
                    rid.acoesCorretivas || '',
                    rid.responsavelAcoes || '',
                    rid.prazoConclusao || '',
                    dataConclusao,
                    rid.status
                ]);
            });
            
            // Converter para CSV
            const csvContent = csvData.map(row => 
                row.map(field => `"${field}"`).join(',')
            ).join('\n');
            
            // Criar e baixar arquivo
            const fileName = `planilha_rids_${new Date().toISOString().split('T')[0]}.csv`;
            const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', fileName);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Determinar período para mensagem
            let periodMessage = 'outubro de 2025';
            if (employeesSelectedStartDate && employeesSelectedEndDate) {
                const startStr = employeesSelectedStartDate.toLocaleDateString('pt-BR');
                const endStr = employeesSelectedEndDate.toLocaleDateString('pt-BR');
                periodMessage = `${startStr} a ${endStr}`;
            } else if (employeesSelectedStartDate && !employeesSelectedEndDate) {
                const startStr = employeesSelectedStartDate.toLocaleDateString('pt-BR');
                periodMessage = `desde ${startStr}`;
            } else if (!employeesSelectedStartDate && employeesSelectedEndDate) {
                const endStr = employeesSelectedEndDate.toLocaleDateString('pt-BR');
                periodMessage = `até ${endStr}`;
            }
            
            alert(`📊 Planilha exportada com sucesso!\n\n📁 Arquivo: ${fileName}\n📅 Período: ${periodMessage}\n✅ ${filteredRids.length} RIDs exportados com todas as colunas`);
        }

        // Fechar menus ao clicar fora
        document.addEventListener('click', function(event) {
            const adminMenu = document.getElementById('adminDropdownMenu');
            const employeeMenu = document.getElementById('employeeDropdownMenu');
            
            // Verificar se o clique não foi no botão do menu ou dentro do menu
            if (!event.target.closest('button[onclick="toggleAdminMenu()"]') && 
                !event.target.closest('#adminDropdownMenu')) {
                adminMenu.classList.add('hidden');
            }
            
            if (!event.target.closest('button[onclick="toggleEmployeeMenu()"]') && 
                !event.target.closest('#employeeDropdownMenu')) {
                employeeMenu.classList.add('hidden');
            }
        });

        // Formatação de CPF e datas
        document.addEventListener('DOMContentLoaded', function() {
            const cpfInputs = document.querySelectorAll('input[type="text"][placeholder*="000.000.000-00"]');
            cpfInputs.forEach(input => {
                input.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                    e.target.value = value;
                });
            });

            // Formatação automática de datas
            const dateInputs = document.querySelectorAll('input[placeholder="dd/mm/aaaa"]');
            dateInputs.forEach(input => {
                input.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    if (value.length >= 2) {
                        value = value.replace(/(\d{2})(\d)/, '$1/$2');
                    }
                    if (value.length >= 5) {
                        value = value.replace(/(\d{2})\/(\d{2})(\d)/, '$1/$2/$3');
                    }
                    if (value.length > 10) {
                        value = value.substring(0, 10);
                    }
                    e.target.value = value;
                });
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'993da75e72651433',t:'MTc2MTM1MjczNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
