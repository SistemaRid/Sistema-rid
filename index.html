<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gest√£o de RIDs</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#D99900',
                        secondary: '#CFCFCF',
                        dark: '#4A4A4A'
                    }
                }
            }
        }
    </script>
    <style>
        body {
            box-sizing: border-box;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal-backdrop {
            backdrop-filter: blur(4px);
        }
        .loading-spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #D99900;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-full">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 bg-white flex items-center justify-center z-50">
        <div class="text-center">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-gray-600">Carregando sistema...</p>
        </div>
    </div>

    <div id="app" class="min-h-full">
        <!-- Tela de Login -->
        <div id="loginScreen" class="min-h-full flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
            <div class="max-w-md w-full space-y-8">
                <div class="text-center">
                    <img src="https://www.jdemito.com.br/wp-content/themes/jdemito/img/logo.png" alt="Logo da Empresa" class="mx-auto h-20 w-auto mb-4" onerror="this.style.display='none';">
                    <h2 class="mt-6 text-3xl font-bold text-dark">Sistema de Gest√£o de RIDs</h2>
                    <p class="mt-2 text-sm text-gray-600">Relat√≥rios de Incidentes e Desvios</p>
                </div>
                
                <div class="bg-white rounded-lg shadow-md p-8">
                    <div class="flex mb-6">
                        <button id="loginTab" class="flex-1 py-2 px-4 text-center border-b-2 border-primary text-primary font-medium">Login</button>
                        <button id="registerTab" class="flex-1 py-2 px-4 text-center border-b-2 border-gray-200 text-gray-500">Cadastro</button>
                    </div>
                    
                    <!-- Formul√°rio de Login -->
                    <form id="loginForm" class="space-y-6">
                        <div>
                            <label for="loginCpf" class="block text-sm font-medium text-dark">CPF</label>
                            <input id="loginCpf" type="text" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary" placeholder="000.000.000-00">
                        </div>
                        <div>
                            <label for="loginPassword" class="block text-sm font-medium text-dark">Senha</label>
                            <input id="loginPassword" type="password" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                        </div>
                        <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-yellow-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                            Entrar
                        </button>
                    </form>
                    
                    <!-- Formul√°rio de Cadastro -->
                    <form id="registerForm" class="space-y-6 hidden">
                        <div>
                            <label for="registerName" class="block text-sm font-medium text-dark">Nome Completo</label>
                            <input id="registerName" type="text" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                        </div>
                        <div>
                            <label for="registerCpf" class="block text-sm font-medium text-dark">CPF</label>
                            <input id="registerCpf" type="text" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary" placeholder="000.000.000-00">
                        </div>
                        <div>
                            <label for="registerSector" class="block text-sm font-medium text-dark">Setor</label>
                            <select id="registerSector" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                                <option value="">Selecione o setor</option>
                                <option value="ADM">ADM</option>
                                <option value="M.MOVEL">M.MOVEL</option>
                                <option value="M.FIXA">M.FIXA</option>
                                <option value="M.EL√âTRICA">M.EL√âTRICA</option>
                                <option value="PRODU√á√ÉO">PRODU√á√ÉO</option>
                                <option value="MINA">MINA</option>
                            </select>
                        </div>
                        <div>
                            <label for="registerPassword" class="block text-sm font-medium text-dark">Senha</label>
                            <input id="registerPassword" type="password" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                        </div>
                        <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-yellow-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                            Cadastrar
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Painel Administrativo -->
        <div id="adminPanel" class="hidden min-h-full">
            <nav class="bg-white shadow-sm border-b border-gray-200">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="flex justify-between h-16">
                        <div class="flex items-center space-x-4">
                            <img src="https://www.jdemito.com.br/wp-content/themes/jdemito/img/logo.png" alt="Logo da Empresa" class="h-10 w-auto" onerror="this.style.display='none';">
                            <h1 class="text-xl font-semibold text-dark">Painel Administrativo</h1>
                        </div>
                        <div class="flex items-center space-x-4">
                            <span class="text-sm text-gray-600" id="adminUserName"></span>
                            <button id="logoutBtn" class="text-sm text-gray-500 hover:text-gray-700" onclick="logout()">Sair</button>
                        </div>
                    </div>
                </div>
            </nav>

            <!-- Barra de Navega√ß√£o Administrativa -->
            <div class="bg-white border-b border-gray-200">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <nav class="flex space-x-8" aria-label="Tabs">
                        <button id="dashboardTabBtn" class="border-primary text-primary whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" onclick="showDashboardSection()">
                            Dashboard
                        </button>
                        <button id="ridsTabBtn" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" onclick="showRidsSection()">
                            Gerenciar RIDs
                        </button>
                        <button id="usersTabBtn" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" onclick="showUsersSection()">
                            Usu√°rios
                        </button>
                        <button id="tasksTabBtn" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" onclick="showTasksSection()">
                            Minhas Tarefas
                        </button>

                    </nav>
                </div>
            </div>

            <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
                <!-- Dashboard b√°sico -->
                <div id="dashboardSection">
                    <div class="bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-medium text-dark mb-4">Dashboard Administrativo</h3>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                            <div class="bg-gray-50 p-4 rounded">
                                <h4 class="font-medium">Total RIDs</h4>
                                <p class="text-2xl font-bold text-primary" id="totalRids">0</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded">
                                <h4 class="font-medium">Pendentes</h4>
                                <p class="text-2xl font-bold text-red-600" id="pendingRids">0</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded">
                                <h4 class="font-medium">Em Andamento</h4>
                                <p class="text-2xl font-bold text-yellow-600" id="inProgressRids">0</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded">
                                <h4 class="font-medium">Conclu√≠dos</h4>
                                <p class="text-2xl font-bold text-green-600" id="completedRids">0</p>
                            </div>
                        </div>
                        
                        <!-- A√ß√µes R√°pidas -->
                        <div class="mt-6">
                            <h4 class="text-lg font-medium text-dark mb-4">A√ß√µes R√°pidas</h4>
                            <div class="flex flex-wrap gap-3">
                                <button onclick="openRidModal()" class="bg-primary hover:bg-yellow-600 text-white font-medium py-2 px-4 rounded flex items-center">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                    </svg>
                                    Criar Novo RID
                                </button>
                                <button onclick="generateReport()" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded flex items-center">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                    Emitir Relat√≥rio
                                </button>
                                <button onclick="openTaskModal()" class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded flex items-center">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                    </svg>
                                    Nova Tarefa
                                </button>
                            </div>
                        </div>

                        <!-- Top 3 Funcion√°rios do M√™s -->
                        <div class="mt-8">
                            <h4 class="text-lg font-medium text-dark mb-4">üèÜ Top 3 Funcion√°rios do M√™s (Outubro 2025)</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4" id="topEmployeesMonth">
                            </div>
                        </div>
                        
                        <!-- Lista de RIDs -->
                        <div class="mt-8">
                            <h4 class="text-lg font-medium text-dark mb-4">RIDs da Semana (20/10 - 26/10)</h4>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">RID</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Emitente</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Data</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Prioridade</th>
                                        </tr>
                                    </thead>
                                    <tbody id="ridsTableBody" class="bg-white divide-y divide-gray-200">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Se√ß√£o Gerenciar RIDs -->
                <div id="ridsSection" class="hidden">
                    <div class="bg-white shadow rounded-lg">
                        <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                            <h3 class="text-lg font-medium text-dark">Gerenciar RIDs</h3>
                            <button onclick="openRidModal()" class="bg-primary hover:bg-yellow-600 text-white font-medium py-2 px-4 rounded">
                                Criar Novo RID
                            </button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">RID</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Emitente</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Data</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Prioridade</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="allRidsTableBody" class="bg-white divide-y divide-gray-200">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Se√ß√£o Usu√°rios -->
                <div id="usersSection" class="hidden">
                    <div class="bg-white shadow rounded-lg">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-medium text-dark">Gerenciar Usu√°rios</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nome</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">CPF</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Setor</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Tipo</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">RIDs Criados</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody" class="bg-white divide-y divide-gray-200">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Se√ß√£o Minhas Tarefas -->
                <div id="tasksSection" class="hidden">
                    <div class="bg-white shadow rounded-lg">
                        <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                            <h3 class="text-lg font-medium text-dark">Minhas Tarefas</h3>
                            <div class="flex space-x-3">
                                <select id="taskFilter" class="px-3 py-2 border border-gray-300 rounded-md text-sm" onchange="filterTasks()">
                                    <option value="all">Todas as Tarefas</option>
                                    <option value="Pendente">Pendentes</option>
                                    <option value="Em Andamento">Em Andamento</option>
                                    <option value="Conclu√≠da">Conclu√≠das</option>
                                </select>
                                <button onclick="openTaskModal()" class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded">
                                    Nova Tarefa
                                </button>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">T√≠tulo</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Prioridade</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Vencimento</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="tasksTableBody" class="bg-white divide-y divide-gray-200">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>


            </div>
        </div>

        <!-- Painel do Funcion√°rio -->
        <div id="employeePanel" class="hidden min-h-full">
            <nav class="bg-white shadow-sm border-b border-gray-200">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="flex justify-between h-16">
                        <div class="flex items-center space-x-4">
                            <img src="https://www.jdemito.com.br/wp-content/themes/jdemito/img/logo.png" alt="Logo da Empresa" class="h-10 w-auto" onerror="this.style.display='none';">
                            <h1 class="text-xl font-semibold text-dark">Meus RIDs</h1>
                        </div>
                        <div class="flex items-center space-x-4">
                            <span class="text-sm text-gray-600" id="employeeUserName"></span>
                            <button id="employeeLogoutBtn" class="text-sm text-gray-500 hover:text-gray-700" onclick="logout()">Sair</button>
                        </div>
                    </div>
                </div>
            </nav>

            <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
                <!-- Bot√£o Criar RID -->
                <div class="mb-6 flex justify-end">
                    <button onclick="openRidModal()" class="bg-primary hover:bg-yellow-600 text-white font-medium py-2 px-4 rounded">
                        Criar Novo RID
                    </button>
                </div>

                <!-- M√©tricas Pessoais -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white shadow rounded-lg p-4">
                        <h4 class="font-medium text-gray-600">Meus RIDs</h4>
                        <p class="text-2xl font-bold text-primary" id="myTotalRids">0</p>
                    </div>
                    <div class="bg-white shadow rounded-lg p-4">
                        <h4 class="font-medium text-gray-600">Pendentes</h4>
                        <p class="text-2xl font-bold text-red-600" id="myPendingRids">0</p>
                    </div>
                    <div class="bg-white shadow rounded-lg p-4">
                        <h4 class="font-medium text-gray-600">Em Andamento</h4>
                        <p class="text-2xl font-bold text-yellow-600" id="myInProgressRids">0</p>
                    </div>
                    <div class="bg-white shadow rounded-lg p-4">
                        <h4 class="font-medium text-gray-600">Conclu√≠dos</h4>
                        <p class="text-2xl font-bold text-green-600" id="myCompletedRids">0</p>
                    </div>
                </div>

                <!-- Tabela de RIDs do Funcion√°rio -->
                <div class="bg-white shadow rounded-lg">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-medium text-dark">Meus RIDs Criados</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">RID</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Data</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Local</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Prioridade</th>
                                </tr>
                            </thead>
                            <tbody id="employeeRidsTableBody" class="bg-white divide-y divide-gray-200">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Cria√ß√£o de Tarefa -->
        <div id="taskModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 modal-backdrop hidden flex items-center justify-center p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-full overflow-y-auto">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-dark">Criar Nova Tarefa</h3>
                </div>
                <form id="taskForm" class="p-6 space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="taskTitle" class="block text-sm font-medium text-dark">T√≠tulo da Tarefa</label>
                            <input id="taskTitle" type="text" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                        </div>
                        <div>
                            <label for="taskPriority" class="block text-sm font-medium text-dark">Prioridade</label>
                            <select id="taskPriority" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                                <option value="">Selecione</option>
                                <option value="Baixa">Baixa</option>
                                <option value="M√©dia">M√©dia</option>
                                <option value="Alta">Alta</option>
                            </select>
                        </div>
                        <div>
                            <label for="taskDueDate" class="block text-sm font-medium text-dark">Data de Vencimento</label>
                            <input id="taskDueDate" type="date" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                        </div>
                        <div class="md:col-span-2">
                            <label for="taskDescription" class="block text-sm font-medium text-dark">Descri√ß√£o</label>
                            <textarea id="taskDescription" rows="4" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"></textarea>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-3 pt-6 border-t border-gray-200">
                        <button type="button" onclick="closeTaskModal()" class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">
                            Cancelar
                        </button>
                        <button type="submit" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700">
                            Criar Tarefa
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal de Visualiza√ß√£o de RID -->
        <div id="viewRidModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 modal-backdrop hidden flex items-center justify-center p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-full overflow-y-auto">
                <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                    <h3 class="text-lg font-medium text-dark" id="viewRidTitle">Detalhes do RID</h3>
                    <button onclick="closeViewRidModal()" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Informa√ß√µes B√°sicas -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-medium text-dark mb-3">Informa√ß√µes B√°sicas</h4>
                            <div class="space-y-2">
                                <div>
                                    <span class="text-sm font-medium text-gray-600">N√∫mero do RID:</span>
                                    <p class="text-sm text-dark" id="viewRidNumero"></p>
                                </div>
                                <div>
                                    <span class="text-sm font-medium text-gray-600">Emitente:</span>
                                    <p class="text-sm text-dark" id="viewRidEmitente"></p>
                                </div>
                                <div>
                                    <span class="text-sm font-medium text-gray-600">Tipo de Contrato:</span>
                                    <p class="text-sm text-dark" id="viewRidTipoContrato"></p>
                                </div>
                                <div>
                                    <span class="text-sm font-medium text-gray-600">Unidade:</span>
                                    <p class="text-sm text-dark" id="viewRidUnidade"></p>
                                </div>
                                <div>
                                    <span class="text-sm font-medium text-gray-600">Setor do Emitente:</span>
                                    <p class="text-sm text-dark" id="viewRidSetorEmitente"></p>
                                </div>
                            </div>
                        </div>

                        <!-- Status e Prioridade -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-medium text-dark mb-3">Status e Prioridade</h4>
                            <div class="space-y-2">
                                <div>
                                    <span class="text-sm font-medium text-gray-600">Status:</span>
                                    <p class="text-sm" id="viewRidStatus"></p>
                                </div>
                                <div>
                                    <span class="text-sm font-medium text-gray-600">Prioridade:</span>
                                    <p class="text-sm" id="viewRidPrioridade"></p>
                                </div>
                                <div>
                                    <span class="text-sm font-medium text-gray-600">Data da Ocorr√™ncia:</span>
                                    <p class="text-sm text-dark" id="viewRidDataOcorrencia"></p>
                                </div>
                                <div>
                                    <span class="text-sm font-medium text-gray-600">Data de Emiss√£o:</span>
                                    <p class="text-sm text-dark" id="viewRidDataEmissao"></p>
                                </div>
                                <div>
                                    <span class="text-sm font-medium text-gray-600">Tipo de Incidente:</span>
                                    <p class="text-sm text-dark" id="viewRidTipoIncidente"></p>
                                </div>
                            </div>
                        </div>

                        <!-- Local da Ocorr√™ncia -->
                        <div class="md:col-span-2 bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-medium text-dark mb-3">Local da Ocorr√™ncia</h4>
                            <p class="text-sm text-dark" id="viewRidLocalOcorrencia"></p>
                        </div>

                        <!-- Descri√ß√£o da Ocorr√™ncia -->
                        <div class="md:col-span-2 bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-medium text-dark mb-3">Descri√ß√£o da Ocorr√™ncia</h4>
                            <p class="text-sm text-dark whitespace-pre-wrap" id="viewRidDescricao"></p>
                        </div>

                        <!-- A√ß√£o Imediata -->
                        <div class="md:col-span-2 bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-medium text-dark mb-3">A√ß√£o Imediata</h4>
                            <p class="text-sm text-dark whitespace-pre-wrap" id="viewRidAcaoImediata"></p>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3 pt-6 border-t border-gray-200 mt-6">
                        <button onclick="closeViewRidModal()" class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">
                            Fechar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Edi√ß√£o de RID -->
        <div id="editRidModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 modal-backdrop hidden flex items-center justify-center p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-full overflow-y-auto">
                <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                    <h3 class="text-lg font-medium text-dark" id="editRidTitle">Editar RID</h3>
                    <button onclick="closeEditRidModal()" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                <form id="editRidForm" class="p-6 space-y-6">
                    <!-- Informa√ß√µes n√£o edit√°veis -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-medium text-dark mb-3">Informa√ß√µes do RID</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div>
                                <span class="font-medium text-gray-600">N√∫mero:</span>
                                <span class="text-dark ml-2" id="editRidNumero"></span>
                            </div>
                            <div>
                                <span class="font-medium text-gray-600">Emitente:</span>
                                <span class="text-dark ml-2" id="editRidEmitente"></span>
                            </div>
                            <div>
                                <span class="font-medium text-gray-600">Data da Ocorr√™ncia:</span>
                                <span class="text-dark ml-2" id="editRidDataOcorrencia"></span>
                            </div>
                            <div>
                                <span class="font-medium text-gray-600">Unidade:</span>
                                <span class="text-dark ml-2" id="editRidUnidade"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Campos edit√°veis -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="editRidStatus" class="block text-sm font-medium text-dark">Status</label>
                            <select id="editRidStatus" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                                <option value="Pendente">Pendente</option>
                                <option value="Em Andamento">Em Andamento</option>
                                <option value="Conclu√≠do">Conclu√≠do</option>
                            </select>
                        </div>
                        <div>
                            <label for="editRidPrioridade" class="block text-sm font-medium text-dark">Prioridade</label>
                            <select id="editRidPrioridade" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                                <option value="Baixa">Baixa</option>
                                <option value="M√©dia">M√©dia</option>
                                <option value="Alta">Alta</option>
                            </select>
                        </div>
                    </div>

                    <!-- Observa√ß√µes da edi√ß√£o -->
                    <div>
                        <label for="editRidObservacoes" class="block text-sm font-medium text-dark">Observa√ß√µes da Edi√ß√£o (Opcional)</label>
                        <textarea id="editRidObservacoes" rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary" placeholder="Adicione observa√ß√µes sobre as altera√ß√µes realizadas..."></textarea>
                    </div>

                    <div class="flex justify-end space-x-3 pt-6 border-t border-gray-200">
                        <button type="button" onclick="closeEditRidModal()" class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">
                            Cancelar
                        </button>
                        <button type="submit" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-yellow-600">
                            Salvar Altera√ß√µes
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal de Cria√ß√£o de RID -->
        <div id="ridModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 modal-backdrop hidden flex items-center justify-center p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-full overflow-y-auto">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-dark">Criar Novo RID</h3>
                </div>
                <form id="ridForm" class="p-6 space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="ridEmitente" class="block text-sm font-medium text-dark">Emitente</label>
                            <input id="ridEmitente" type="text" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                        </div>
                        <div>
                            <label for="ridTipoContrato" class="block text-sm font-medium text-dark">Tipo de Contrato</label>
                            <select id="ridTipoContrato" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                                <option value="">Selecione</option>
                                <option value="Funcion√°rio">Funcion√°rio</option>
                                <option value="Terceiro">Terceiro</option>
                                <option value="Contratado">Contratado</option>
                                <option value="Eventual">Eventual</option>
                                <option value="Visitante">Visitante</option>
                            </select>
                        </div>
                        <div>
                            <label for="ridUnidade" class="block text-sm font-medium text-dark">Unidade</label>
                            <select id="ridUnidade" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                                <option value="">Selecione</option>
                                <option value="Calnamix">Calnamix</option>
                                <option value="Calpi">Calpi</option>
                                <option value="Caltins">Caltins</option>
                                <option value="Formacal">Formacal</option>
                                <option value="Gessotins">Gessotins</option>
                                <option value="Imp√©rio Caltins">Imp√©rio Caltins</option>
                                <option value="Minerax">Minerax</option>
                                <option value="Minertins">Minertins</option>
                                <option value="Natical">Natical</option>
                                <option value="Nobretins">Nobretins</option>
                                <option value="Supercal">Supercal</option>
                            </select>
                        </div>
                        <div>
                            <label for="ridSetorEmitente" class="block text-sm font-medium text-dark">Setor do Emitente</label>
                            <select id="ridSetorEmitente" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                                <option value="">Selecione</option>
                                <option value="ADM">ADM</option>
                                <option value="M.MOVEL">M.MOVEL</option>
                                <option value="M.FIXA">M.FIXA</option>
                                <option value="M.EL√âTRICA">M.EL√âTRICA</option>
                                <option value="PRODU√á√ÉO">PRODU√á√ÉO</option>
                                <option value="MINA">MINA</option>
                            </select>
                        </div>
                        <div>
                            <label for="ridDataOcorrencia" class="block text-sm font-medium text-dark">Data da Ocorr√™ncia</label>
                            <input id="ridDataOcorrencia" type="date" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                        </div>
                        <div>
                            <label for="ridTipoIncidente" class="block text-sm font-medium text-dark">Incidente ou Desvio</label>
                            <select id="ridTipoIncidente" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                                <option value="">Selecione</option>
                                <option value="Condi√ß√£o de Risco">Condi√ß√£o de Risco</option>
                                <option value="Desvio Comportamental">Desvio Comportamental</option>
                                <option value="Dano Material">Dano Material</option>
                                <option value="Quase acidente">Quase acidente</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <label for="ridLocalOcorrencia" class="block text-sm font-medium text-dark">Local da Ocorr√™ncia</label>
                            <input id="ridLocalOcorrencia" type="text" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                        </div>
                        <div class="md:col-span-2">
                            <label for="ridDescricao" class="block text-sm font-medium text-dark">Descri√ß√£o da Ocorr√™ncia</label>
                            <textarea id="ridDescricao" rows="4" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"></textarea>
                        </div>
                        <div class="md:col-span-2">
                            <label for="ridAcaoImediata" class="block text-sm font-medium text-dark">A√ß√£o Imediata</label>
                            <textarea id="ridAcaoImediata" rows="3" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"></textarea>
                        </div>
                        <div>
                            <label for="ridPrioridade" class="block text-sm font-medium text-dark">Prioridade</label>
                            <select id="ridPrioridade" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                                <option value="">Selecione</option>
                                <option value="Baixa">Baixa</option>
                                <option value="M√©dia">M√©dia</option>
                                <option value="Alta">Alta</option>
                            </select>
                        </div>
                        <div>
                            <label for="ridStatus" class="block text-sm font-medium text-dark">Status</label>
                            <select id="ridStatus" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                                <option value="Pendente">Pendente</option>
                                <option value="Em Andamento">Em Andamento</option>
                                <option value="Conclu√≠do">Conclu√≠do</option>
                            </select>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-3 pt-6 border-t border-gray-200">
                        <button type="button" onclick="closeRidModal()" class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">
                            Cancelar
                        </button>
                        <button type="submit" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-yellow-600">
                            Salvar RID
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Sistema de dados com sincroniza√ß√£o usando Firebase
        let users = [];
        let rids = [];
        let tasks = [];
        let currentUser = null;
        let ridCounter = 0;
        let currentRidId = null;
        let currentTaskFilter = 'all';
        
        // Configura√ß√£o do Firebase
        const FIREBASE_URL = 'https://rids-sistema-default-rtdb.firebaseio.com';
        
        // Fun√ß√£o para inicializar o sistema
        async function initSystem() {
            try {
                // Tentar carregar do servidor com timeout
                const timeoutPromise = new Promise((_, reject) => 
                    setTimeout(() => reject(new Error('Timeout')), 5000)
                );
                
                await Promise.race([loadDataFromServer(), timeoutPromise]);
                console.log('‚úÖ Dados carregados do servidor online');
            } catch (error) {
                console.log('‚ö†Ô∏è Servidor offline ou lento, usando dados locais');
                loadLocalData();
            }
            
            hideLoadingScreen();
        }
        
        // Carregar dados do servidor Firebase
        async function loadDataFromServer() {
            try {
                const response = await fetch(`${FIREBASE_URL}/sistema.json`);
                
                if (!response.ok) throw new Error('Erro na resposta do servidor');
                
                const data = await response.json();
                
                if (data && data.users) {
                    users = data.users || [];
                    rids = data.rids || [];
                    tasks = data.tasks || [];
                    ridCounter = data.ridCounter || 0;
                } else {
                    // Primeira vez - inicializar dados padr√£o
                    initializeDefaultData();
                    await saveDataToServer();
                }
                
                // Salvar backup local
                saveLocalBackup();
                
            } catch (error) {
                console.error('Erro ao carregar do servidor:', error);
                throw error;
            }
        }
        
        // Salvar dados no servidor Firebase
        async function saveDataToServer() {
            try {
                const dataToSave = {
                    users: users,
                    rids: rids,
                    tasks: tasks,
                    ridCounter: ridCounter,
                    lastUpdate: new Date().toISOString(),
                    version: Date.now()
                };
                
                const response = await fetch(`${FIREBASE_URL}/sistema.json`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(dataToSave)
                });
                
                if (!response.ok) throw new Error('Erro ao salvar no servidor');
                
                // Salvar backup local
                saveLocalBackup();
                
                console.log('‚úÖ Dados salvos no servidor online');
                
            } catch (error) {
                console.error('‚ùå Erro ao salvar no servidor:', error);
                // Fallback para localStorage
                saveLocalBackup();
                
                // Mostrar notifica√ß√£o de erro
                showNotification('Dados salvos localmente. Verifique sua conex√£o.', 'warning');
            }
        }
        
        // Salvar backup local
        function saveLocalBackup() {
            localStorage.setItem('rids_users', JSON.stringify(users));
            localStorage.setItem('rids_data', JSON.stringify(rids));
            localStorage.setItem('rids_tasks', JSON.stringify(tasks));
            localStorage.setItem('rid_counter', ridCounter.toString());
        }
        
        // Carregar dados locais
        function loadLocalData() {
            users = JSON.parse(localStorage.getItem('rids_users') || '[]');
            rids = JSON.parse(localStorage.getItem('rids_data') || '[]');
            tasks = JSON.parse(localStorage.getItem('rids_tasks') || '[]');
            ridCounter = parseInt(localStorage.getItem('rid_counter') || '0');
            
            if (users.length === 0) {
                initializeDefaultData();
            }
        }
        
        // Inicializar dados padr√£o
        function initializeDefaultData() {
            // Adicionar usu√°rio admin padr√£o
            users = [{
                id: 'admin',
                name: 'Administrador',
                cpf: '111.111.111-11',
                password: '222222',
                sector: 'ADM',
                isAdmin: true
            }];
            
            // Adicionar funcion√°rios de exemplo
            const exemploFuncionarios = [
                { id: 'func1', name: 'Jo√£o Silva Santos', cpf: '123.456.789-01', password: '123456', sector: 'PRODU√á√ÉO', isAdmin: false },
                { id: 'func2', name: 'Maria Oliveira Costa', cpf: '234.567.890-12', password: '123456', sector: 'M.MOVEL', isAdmin: false },
                { id: 'func3', name: 'Carlos Eduardo Lima', cpf: '345.678.901-23', password: '123456', sector: 'M.FIXA', isAdmin: false },
                { id: 'func4', name: 'Ana Paula Ferreira', cpf: '456.789.012-34', password: '123456', sector: 'M.EL√âTRICA', isAdmin: false },
                { id: 'func5', name: 'Roberto Almeida Souza', cpf: '567.890.123-45', password: '123456', sector: 'MINA', isAdmin: false },
                { id: 'func6', name: 'Fernanda Castro Rocha', cpf: '678.901.234-56', password: '123456', sector: 'ADM', isAdmin: false }
            ];
            
            users.push(...exemploFuncionarios);
            
            // Inicializar arrays vazios para RIDs e tarefas
            rids = [];
            tasks = [];
            ridCounter = 0;
        }
        
        // Esconder tela de loading
        function hideLoadingScreen() {
            document.getElementById('loadingScreen').style.display = 'none';
        }
        
        // Mostrar notifica√ß√£o
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : 
                           type === 'warning' ? 'bg-yellow-500' : 'bg-red-500';
            
            notification.className = `fixed top-4 right-4 ${bgColor} text-white px-4 py-2 rounded shadow-lg z-50`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            }, 3000);
        }
        
        // Sincroniza√ß√£o autom√°tica a cada 30 segundos
        setInterval(async () => {
            if (navigator.onLine) {
                try {
                    await loadDataFromServer();
                    // Atualizar interface se necess√°rio
                    if (currentUser) {
                        if (currentUser.isAdmin) {
                            updateAdminDashboard();
                            loadRidsTable();
                            updateTopEmployees();
                        } else {
                            updateEmployeeDashboard();
                            loadEmployeeRidsTable();
                        }
                    }
                } catch (error) {
                    console.log('Sincroniza√ß√£o autom√°tica falhou');
                }
            }
        }, 30000); // 30 segundos
        
        // Detectar quando volta online
        window.addEventListener('online', async () => {
            showNotification('Conex√£o restaurada! Sincronizando dados...', 'success');
            try {
                await loadDataFromServer();
                await saveDataToServer();
            } catch (error) {
                console.error('Erro na sincroniza√ß√£o:', error);
            }
        });
        
        // Detectar quando fica offline
        window.addEventListener('offline', () => {
            showNotification('Sem conex√£o. Dados ser√£o salvos localmente.', 'warning');
        });
        
        // Modificar todas as fun√ß√µes que salvam dados para usar o novo sistema
        
        // Formata√ß√£o de CPF
        function formatCPF(value) {
            return value.replace(/\D/g, '').replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
        }

        // Adicionar formata√ß√£o autom√°tica aos campos CPF
        document.getElementById('loginCpf').addEventListener('input', function(e) {
            e.target.value = formatCPF(e.target.value);
        });
        document.getElementById('registerCpf').addEventListener('input', function(e) {
            e.target.value = formatCPF(e.target.value);
        });

        // Tabs de login/cadastro
        const loginTab = document.getElementById('loginTab');
        const registerTab = document.getElementById('registerTab');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');

        loginTab.addEventListener('click', function() {
            loginTab.classList.add('border-primary', 'text-primary');
            loginTab.classList.remove('border-gray-200', 'text-gray-500');
            registerTab.classList.remove('border-primary', 'text-primary');
            registerTab.classList.add('border-gray-200', 'text-gray-500');
            loginForm.classList.remove('hidden');
            registerForm.classList.add('hidden');
        });

        registerTab.addEventListener('click', function() {
            registerTab.classList.add('border-primary', 'text-primary');
            registerTab.classList.remove('border-gray-200', 'text-gray-500');
            loginTab.classList.remove('border-primary', 'text-primary');
            loginTab.classList.add('border-gray-200', 'text-gray-500');
            registerForm.classList.remove('hidden');
            loginForm.classList.add('hidden');
        });

        // Login
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const cpf = document.getElementById('loginCpf').value;
            const password = document.getElementById('loginPassword').value;

            const user = users.find(u => u.cpf === cpf && u.password === password);
            if (user) {
                currentUser = user;
                if (user.isAdmin) {
                    showAdminPanel();
                } else {
                    showEmployeePanel();
                }
            } else {
                showNotification('CPF ou senha incorretos!', 'error');
            }
        });

        // Cadastro
        registerForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const name = document.getElementById('registerName').value;
            const cpf = document.getElementById('registerCpf').value;
            const sector = document.getElementById('registerSector').value;
            const password = document.getElementById('registerPassword').value;

            if (users.find(u => u.cpf === cpf)) {
                showNotification('CPF j√° cadastrado!', 'error');
                return;
            }

            const newUser = {
                id: Date.now().toString(),
                name,
                cpf,
                sector,
                password,
                isAdmin: false
            };

            users.push(newUser);
            await saveDataToServer();
            
            showNotification('Usu√°rio cadastrado com sucesso!', 'success');
            
            // Limpar formul√°rio e voltar para login
            registerForm.reset();
            loginTab.click();
        });

        // Salvar RID (modificado para usar sincroniza√ß√£o)
        document.getElementById('ridForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const ridData = {
                emitente: document.getElementById('ridEmitente').value,
                tipoContrato: document.getElementById('ridTipoContrato').value,
                unidade: document.getElementById('ridUnidade').value,
                setorEmitente: document.getElementById('ridSetorEmitente').value,
                dataOcorrencia: document.getElementById('ridDataOcorrencia').value,
                tipoIncidente: document.getElementById('ridTipoIncidente').value,
                localOcorrencia: document.getElementById('ridLocalOcorrencia').value,
                descricao: document.getElementById('ridDescricao').value,
                acaoImediata: document.getElementById('ridAcaoImediata').value,
                prioridade: document.getElementById('ridPrioridade').value,
                status: document.getElementById('ridStatus').value,
                emitenteCpf: currentUser.cpf,
                dataEmissao: new Date().toISOString().split('T')[0]
            };

            ridCounter++;
            const newRid = {
                id: Date.now().toString(),
                numero: `RID-${ridCounter.toString().padStart(4, '0')}`,
                ...ridData
            };
            
            rids.push(newRid);
            
            // Salvar no servidor online
            await saveDataToServer();
            
            document.getElementById('ridModal').classList.add('hidden');
            
            showNotification('RID criado e sincronizado com sucesso!', 'success');
            
            // Atualizar dashboards e tabelas
            if (currentUser.isAdmin) {
                updateAdminDashboard();
                loadRidsTable();
                updateTopEmployeesMonth();
            } else {
                updateEmployeeDashboard();
                loadEmployeeRidsTable();
            }
        });

        // Salvar backup local
        function saveLocalBackup() {
            localStorage.setItem('rids_users', JSON.stringify(users));
            localStorage.setItem('rids_data', JSON.stringify(rids));
            localStorage.setItem('rids_tasks', JSON.stringify(tasks));
            localStorage.setItem('rid_counter', ridCounter.toString());
        }
        
        // Carregar dados locais
        function loadLocalData() {
            users = JSON.parse(localStorage.getItem('rids_users') || '[]');
            rids = JSON.parse(localStorage.getItem('rids_data') || '[]');
            tasks = JSON.parse(localStorage.getItem('rids_tasks') || '[]');
            ridCounter = parseInt(localStorage.getItem('rid_counter') || '0');
            
            if (users.length === 0) {
                initializeDefaultData();
            }
        }
        
        // Inicializar dados padr√£o
        function initializeDefaultData() {
            // Adicionar usu√°rio admin padr√£o
            users = [{
                id: 'admin',
                name: 'Administrador',
                cpf: '111.111.111-11',
                password: '222222',
                sector: 'ADM',
                isAdmin: true
            }];
            
            // Adicionar funcion√°rios de exemplo
            const exemploFuncionarios = [
                { id: 'func1', name: 'Jo√£o Silva Santos', cpf: '123.456.789-01', password: '123456', sector: 'PRODU√á√ÉO', isAdmin: false },
                { id: 'func2', name: 'Maria Oliveira Costa', cpf: '234.567.890-12', password: '123456', sector: 'M.MOVEL', isAdmin: false },
                { id: 'func3', name: 'Carlos Eduardo Lima', cpf: '345.678.901-23', password: '123456', sector: 'M.FIXA', isAdmin: false },
                { id: 'func4', name: 'Ana Paula Ferreira', cpf: '456.789.012-34', password: '123456', sector: 'M.EL√âTRICA', isAdmin: false },
                { id: 'func5', name: 'Roberto Almeida Souza', cpf: '567.890.123-45', password: '123456', sector: 'MINA', isAdmin: false },
                { id: 'func6', name: 'Fernanda Castro Rocha', cpf: '678.901.234-56', password: '123456', sector: 'ADM', isAdmin: false }
            ];
            
            users.push(...exemploFuncionarios);
            
            // Adicionar RIDs de exemplo (incluindo alguns da semana atual)
            const exemploRids = [
                {
                    id: 'rid1',
                    numero: 'RID-0001',
                    emitente: 'Jo√£o Silva Santos',
                    emitenteCpf: '123.456.789-01',
                    tipoContrato: 'Funcion√°rio',
                    unidade: 'Calnamix',
                    setorEmitente: 'PRODU√á√ÉO',
                    dataOcorrencia: '2025-10-15',
                    dataEmissao: '2025-10-15',
                    tipoIncidente: 'Condi√ß√£o de Risco',
                    localOcorrencia: '√Årea de produ√ß√£o - Linha 2',
                    descricao: 'Identificado vazamento de √≥leo hidr√°ulico pr√≥ximo ao equipamento de britagem, criando risco de escorregamento para os operadores.',
                    acaoImediata: '√Årea isolada com cones de sinaliza√ß√£o, limpeza do √≥leo derramado e comunica√ß√£o √† manuten√ß√£o para reparo urgente.',
                    prioridade: 'Alta',
                    status: 'Conclu√≠do',
                    dataConclusao: '2025-10-17'
                },
                {
                    id: 'rid2',
                    numero: 'RID-0002',
                    emitente: 'Maria Oliveira Costa',
                    emitenteCpf: '234.567.890-12',
                    tipoContrato: 'Funcion√°rio',
                    unidade: 'Supercal',
                    setorEmitente: 'M.MOVEL',
                    dataOcorrencia: '2025-10-18',
                    dataEmissao: '2025-10-18',
                    tipoIncidente: 'Desvio Comportamental',
                    localOcorrencia: 'P√°tio de manobras',
                    descricao: 'Operador de empilhadeira circulando em velocidade acima do permitido na √°rea de estoque, sem utilizar cinto de seguran√ßa.',
                    acaoImediata: 'Operador orientado sobre normas de seguran√ßa, velocidade reduzida e uso obrigat√≥rio de EPI. Supervis√£o refor√ßada.',
                    prioridade: 'M√©dia',
                    status: 'Em Andamento'
                },
                {
                    id: 'rid3',
                    numero: 'RID-0003',
                    emitente: 'Carlos Eduardo Lima',
                    emitenteCpf: '345.678.901-23',
                    tipoContrato: 'Funcion√°rio',
                    unidade: 'Minerax',
                    setorEmitente: 'M.FIXA',
                    dataOcorrencia: '2025-10-23',
                    dataEmissao: '2025-10-23',
                    tipoIncidente: 'Dano Material',
                    localOcorrencia: 'Oficina de manuten√ß√£o',
                    descricao: 'Ferramenta pneum√°tica apresentou falha durante opera√ß√£o, causando dano ao componente em manuten√ß√£o.',
                    acaoImediata: 'Ferramenta retirada de opera√ß√£o, componente substitu√≠do e revis√£o de todas as ferramentas pneum√°ticas programada.',
                    prioridade: 'M√©dia',
                    status: 'Pendente'
                },
                {
                    id: 'rid4',
                    numero: 'RID-0004',
                    emitente: 'Ana Paula Ferreira',
                    emitenteCpf: '456.789.012-34',
                    tipoContrato: 'Funcion√°rio',
                    unidade: 'Caltins',
                    setorEmitente: 'M.EL√âTRICA',
                    dataOcorrencia: '2025-10-24',
                    dataEmissao: '2025-10-24',
                    tipoIncidente: 'Quase acidente',
                    localOcorrencia: 'Subesta√ß√£o el√©trica',
                    descricao: 'T√©cnico quase sofreu choque el√©trico ao realizar manuten√ß√£o sem desligar disjuntor principal.',
                    acaoImediata: 'Procedimento de lockout/tagout refor√ßado, treinamento de seguran√ßa el√©trica reagendado para toda equipe.',
                    prioridade: 'Alta',
                    status: 'Em Andamento'
                },
                {
                    id: 'rid5',
                    numero: 'RID-0005',
                    emitente: 'Roberto Almeida Souza',
                    emitenteCpf: '567.890.123-45',
                    tipoContrato: 'Funcion√°rio',
                    unidade: 'Formacal',
                    setorEmitente: 'MINA',
                    dataOcorrencia: '2025-10-25',
                    dataEmissao: '2025-10-25',
                    tipoIncidente: 'Condi√ß√£o de Risco',
                    localOcorrencia: 'Frente de lavra - Bancada 3',
                    descricao: 'Identificada instabilidade em talude da bancada, com risco de desmoronamento.',
                    acaoImediata: '√Årea isolada imediatamente, opera√ß√µes suspensas no local, ge√≥logo acionado para avalia√ß√£o.',
                    prioridade: 'Alta',
                    status: 'Pendente'
                }
            ];
            
            rids = exemploRids;
            ridCounter = 5;
            tasks = [];
        }
        
        // Esconder tela de loading
        function hideLoadingScreen() {
            document.getElementById('loadingScreen').style.display = 'none';
        }
        
        // Mostrar notifica√ß√£o
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : 
                           type === 'warning' ? 'bg-yellow-500' : 'bg-red-500';
            
            notification.className = `fixed top-4 right-4 ${bgColor} text-white px-4 py-2 rounded shadow-lg z-50`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            }, 3000);
        }
        
        // Sincroniza√ß√£o autom√°tica a cada 30 segundos
        setInterval(async () => {
            if (navigator.onLine && currentUser) {
                try {
                    await loadDataFromServer();
                    // Atualizar interface se necess√°rio
                    if (currentUser.isAdmin) {
                        updateAdminDashboard();
                        loadRidsTable();
                        updateTopEmployeesMonth();
                    } else {
                        updateEmployeeDashboard();
                        loadEmployeeRidsTable();
                    }
                } catch (error) {
                    console.log('Sincroniza√ß√£o autom√°tica falhou');
                }
            }
        }, 30000); // 30 segundos
        
        // Detectar quando volta online
        window.addEventListener('online', async () => {
            showNotification('Conex√£o restaurada! Sincronizando dados...', 'success');
            try {
                await loadDataFromServer();
                await saveDataToServer();
            } catch (error) {
                console.error('Erro na sincroniza√ß√£o:', error);
            }
        });
        
        // Detectar quando fica offline
        window.addEventListener('offline', () => {
            showNotification('Sem conex√£o. Dados ser√£o salvos localmente.', 'warning');
        });

        // Elementos DOM
        const loginScreen = document.getElementById('loginScreen');
        const adminPanel = document.getElementById('adminPanel');
        const employeePanel = document.getElementById('employeePanel');

        // Login
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const cpf = document.getElementById('loginCpf').value;
            const password = document.getElementById('loginPassword').value;

            const user = users.find(u => u.cpf === cpf && u.password === password);
            if (user) {
                currentUser = user;
                if (user.isAdmin) {
                    showAdminPanel();
                } else {
                    showEmployeePanel();
                }
            } else {
                showNotification('CPF ou senha incorretos!', 'error');
            }
        });

        // Cadastro
        registerForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const name = document.getElementById('registerName').value;
            const cpf = document.getElementById('registerCpf').value;
            const sector = document.getElementById('registerSector').value;
            const password = document.getElementById('registerPassword').value;

            if (users.find(u => u.cpf === cpf)) {
                showNotification('CPF j√° cadastrado!', 'error');
                return;
            }

            const newUser = {
                id: Date.now().toString(),
                name,
                cpf,
                sector,
                password,
                isAdmin: false
            };

            users.push(newUser);
            await saveDataToServer();
            
            showNotification('Usu√°rio cadastrado com sucesso!', 'success');
            
            // Limpar formul√°rio e voltar para login
            registerForm.reset();
            loginTab.click();
        });

        // Mostrar painel administrativo
        function showAdminPanel() {
            // Esconder todas as telas
            loginScreen.classList.add('hidden');
            document.getElementById('employeePanel').classList.add('hidden');
            
            // Mostrar apenas o painel admin
            document.getElementById('adminPanel').classList.remove('hidden');
            document.getElementById('adminUserName').textContent = currentUser.name;
            
            // Mostrar dashboard por padr√£o
            showDashboardSection();
        }

        // Fun√ß√£o para atualizar top 3 funcion√°rios do m√™s
        function updateTopEmployeesMonth() {
            // Filtrar RIDs do m√™s atual (outubro 2025)
            const currentMonth = new Date('2025-10-01');
            const nextMonth = new Date('2025-11-01');
            
            const monthRids = rids.filter(rid => {
                const ridDate = new Date(rid.dataOcorrencia);
                return ridDate >= currentMonth && ridDate < nextMonth;
            });
            
            // Contar RIDs por funcion√°rio
            const employeeCounts = {};
            monthRids.forEach(rid => {
                employeeCounts[rid.emitenteCpf] = (employeeCounts[rid.emitenteCpf] || 0) + 1;
            });
            
            // Ordenar e pegar top 3
            const topEmployees = Object.entries(employeeCounts)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 3)
                .map(([cpf, count], index) => {
                    const user = users.find(u => u.cpf === cpf);
                    return { 
                        name: user ? user.name : 'N/A', 
                        sector: user ? user.sector : 'N/A',
                        count, 
                        position: index + 1 
                    };
                });
            
            // Atualizar interface
            const container = document.getElementById('topEmployeesMonth');
            container.innerHTML = topEmployees.map(emp => {
                const medalColor = emp.position === 1 ? 'text-yellow-500' : 
                                 emp.position === 2 ? 'text-gray-400' : 'text-yellow-600';
                const bgColor = emp.position === 1 ? 'bg-yellow-50 border-yellow-200' : 
                               emp.position === 2 ? 'bg-gray-50 border-gray-200' : 'bg-yellow-50 border-yellow-200';
                
                return `
                    <div class="bg-white border-2 ${bgColor} rounded-lg p-3 text-center">
                        <div class="text-lg ${medalColor} mb-1">
                            ${emp.position === 1 ? 'ü•á' : emp.position === 2 ? 'ü•à' : 'ü•â'}
                        </div>
                        <h5 class="font-medium text-dark text-xs">${emp.name}</h5>
                        <p class="text-xs text-gray-600 mb-1">${emp.sector}</p>
                        <p class="text-sm font-bold text-primary">${emp.count} RIDs</p>
                        <p class="text-xs text-gray-500">${emp.position}¬∫ lugar</p>
                    </div>
                `;
            }).join('');
            
            // Se n√£o houver funcion√°rios suficientes, preencher com placeholders
            if (topEmployees.length < 3) {
                const remaining = 3 - topEmployees.length;
                for (let i = 0; i < remaining; i++) {
                    const position = topEmployees.length + i + 1;
                    const medalEmoji = position === 1 ? 'ü•á' : position === 2 ? 'ü•à' : 'ü•â';
                    container.innerHTML += `
                        <div class="bg-white border-2 border-gray-100 rounded-lg p-3 text-center opacity-50">
                            <div class="text-lg text-gray-300 mb-1">${medalEmoji}</div>
                            <h5 class="font-medium text-gray-400 text-xs">Sem dados</h5>
                            <p class="text-xs text-gray-400 mb-1">-</p>
                            <p class="text-sm font-bold text-gray-400">0 RIDs</p>
                            <p class="text-xs text-gray-400">${position}¬∫ lugar</p>
                        </div>
                    `;
                }
            }
        }

        // Fun√ß√£o para gerar relat√≥rio
        function generateReport() {
            const reportData = {
                totalRids: rids.length,
                byStatus: {
                    pendente: rids.filter(r => r.status === 'Pendente').length,
                    emAndamento: rids.filter(r => r.status === 'Em Andamento').length,
                    concluido: rids.filter(r => r.status === 'Conclu√≠do').length
                },
                byPriority: {
                    alta: rids.filter(r => r.prioridade === 'Alta').length,
                    media: rids.filter(r => r.prioridade === 'M√©dia').length,
                    baixa: rids.filter(r => r.prioridade === 'Baixa').length
                },
                bySector: {}
            };
            
            // Contar por setor
            rids.forEach(rid => {
                reportData.bySector[rid.setorEmitente] = (reportData.bySector[rid.setorEmitente] || 0) + 1;
            });
            
            // Criar conte√∫do do relat√≥rio
            const reportContent = `
                RELAT√ìRIO DE RIDs - ${new Date().toLocaleDateString('pt-BR')}
                ================================================
                
                RESUMO GERAL:
                ‚Ä¢ Total de RIDs: ${reportData.totalRids}
                
                POR STATUS:
                ‚Ä¢ Pendentes: ${reportData.byStatus.pendente}
                ‚Ä¢ Em Andamento: ${reportData.byStatus.emAndamento}
                ‚Ä¢ Conclu√≠dos: ${reportData.byStatus.concluido}
                
                POR PRIORIDADE:
                ‚Ä¢ Alta: ${reportData.byPriority.alta}
                ‚Ä¢ M√©dia: ${reportData.byPriority.media}
                ‚Ä¢ Baixa: ${reportData.byPriority.baixa}
                
                POR SETOR:
                ${Object.entries(reportData.bySector).map(([setor, count]) => `‚Ä¢ ${setor}: ${count}`).join('\n')}
                
                ================================================
                Relat√≥rio gerado em: ${new Date().toLocaleString('pt-BR')}
            `;
            
            // Criar e baixar arquivo
            const blob = new Blob([reportContent], { type: 'text/plain;charset=utf-8' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `relatorio-rids-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showNotification('Relat√≥rio gerado e baixado com sucesso!', 'success');
        }

        // Fun√ß√µes do modal de tarefa
        function openTaskModal() {
            document.getElementById('taskModal').classList.remove('hidden');
            
            // Definir data m√≠nima como hoje
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('taskDueDate').min = today;
        }

        function closeTaskModal() {
            document.getElementById('taskModal').classList.add('hidden');
            document.getElementById('taskForm').reset();
        }

        // Salvar tarefa
        document.getElementById('taskForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const taskData = {
                title: document.getElementById('taskTitle').value,
                description: document.getElementById('taskDescription').value,
                priority: document.getElementById('taskPriority').value,
                assigneeCpf: currentUser.cpf, // Atribuir ao usu√°rio atual
                dueDate: document.getElementById('taskDueDate').value,
                status: 'Pendente',
                createdBy: currentUser.cpf,
                createdAt: new Date().toISOString().split('T')[0]
            };

            const newTask = {
                id: Date.now().toString(),
                ...taskData
            };
            
            tasks.push(newTask);
            
            // Salvar no servidor
            await saveDataToServer();
            
            closeTaskModal();
            
            showNotification('Tarefa criada com sucesso!', 'success');
        });

        // Fun√ß√µes de navega√ß√£o administrativa
        function showDashboardSection() {
            // Esconder todas as se√ß√µes
            document.getElementById('dashboardSection').classList.remove('hidden');
            document.getElementById('ridsSection').classList.add('hidden');
            document.getElementById('usersSection').classList.add('hidden');
            document.getElementById('tasksSection').classList.add('hidden');
            
            // Atualizar tabs
            updateActiveTab('dashboardTabBtn');
            
            // Atualizar dados do dashboard
            updateAdminDashboard();
            loadRidsTable();
            updateTopEmployeesMonth();
        }

        function showRidsSection() {
            // Esconder todas as se√ß√µes
            document.getElementById('dashboardSection').classList.add('hidden');
            document.getElementById('ridsSection').classList.remove('hidden');
            document.getElementById('usersSection').classList.add('hidden');
            document.getElementById('tasksSection').classList.add('hidden');
            
            // Atualizar tabs
            updateActiveTab('ridsTabBtn');
            
            // Carregar todos os RIDs
            loadAllRidsTable();
        }

        function showUsersSection() {
            // Esconder todas as se√ß√µes
            document.getElementById('dashboardSection').classList.add('hidden');
            document.getElementById('ridsSection').classList.add('hidden');
            document.getElementById('usersSection').classList.remove('hidden');
            document.getElementById('tasksSection').classList.add('hidden');
            
            // Atualizar tabs
            updateActiveTab('usersTabBtn');
            
            // Carregar usu√°rios
            loadUsersTable();
        }

        function showTasksSection() {
            // Esconder todas as se√ß√µes
            document.getElementById('dashboardSection').classList.add('hidden');
            document.getElementById('ridsSection').classList.add('hidden');
            document.getElementById('usersSection').classList.add('hidden');
            document.getElementById('tasksSection').classList.remove('hidden');
            
            // Atualizar tabs
            updateActiveTab('tasksTabBtn');
            
            // Carregar tarefas
            loadTasksTable();
        }



        function updateActiveTab(activeTabId) {
            // Remover classe ativa de todos os tabs
            const tabs = ['dashboardTabBtn', 'ridsTabBtn', 'usersTabBtn', 'tasksTabBtn'];
            tabs.forEach(tabId => {
                const tab = document.getElementById(tabId);
                tab.classList.remove('border-primary', 'text-primary');
                tab.classList.add('border-transparent', 'text-gray-500');
            });
            
            // Adicionar classe ativa ao tab selecionado
            const activeTab = document.getElementById(activeTabId);
            activeTab.classList.add('border-primary', 'text-primary');
            activeTab.classList.remove('border-transparent', 'text-gray-500');
        }

        function loadAllRidsTable() {
            const tbody = document.getElementById('allRidsTableBody');
            tbody.innerHTML = rids.map(rid => {
                const user = users.find(u => u.cpf === rid.emitenteCpf);
                const statusColor = rid.status === 'Pendente' ? 'bg-red-100 text-red-800' : 
                                  rid.status === 'Em Andamento' ? 'bg-yellow-100 text-yellow-800' : 
                                  'bg-green-100 text-green-800';
                const priorityColor = rid.prioridade === 'Alta' ? 'bg-red-100 text-red-800' : 
                                    rid.prioridade === 'M√©dia' ? 'bg-yellow-100 text-yellow-800' : 
                                    'bg-green-100 text-green-800';

                return `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-dark">${rid.numero}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${user ? user.name : 'N/A'}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${new Date(rid.dataOcorrencia).toLocaleDateString('pt-BR')}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusColor}">
                                ${rid.status}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${priorityColor}">
                                ${rid.prioridade}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            <button class="text-primary hover:text-yellow-600 mr-2" onclick="viewRid('${rid.id}')">Ver</button>
                            <button class="text-blue-600 hover:text-blue-800" onclick="editRid('${rid.id}')">Editar</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function loadUsersTable() {
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = users.map(user => {
                const userRids = rids.filter(r => r.emitenteCpf === user.cpf);
                return `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-dark">${user.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${user.cpf}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${user.sector}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${user.isAdmin ? 'bg-purple-100 text-purple-800' : 'bg-gray-100 text-gray-800'}">
                                ${user.isAdmin ? 'Admin' : 'Funcion√°rio'}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${userRids.length}</td>
                    </tr>
                `;
            }).join('');
        }



        function viewRid(ridId) {
            const rid = rids.find(r => r.id === ridId);
            if (!rid) {
                showNotification('RID n√£o encontrado!', 'error');
                return;
            }

            // Preencher dados no modal
            document.getElementById('viewRidTitle').textContent = `Detalhes do ${rid.numero}`;
            document.getElementById('viewRidNumero').textContent = rid.numero;
            document.getElementById('viewRidEmitente').textContent = rid.emitente;
            document.getElementById('viewRidTipoContrato').textContent = rid.tipoContrato;
            document.getElementById('viewRidUnidade').textContent = rid.unidade;
            document.getElementById('viewRidSetorEmitente').textContent = rid.setorEmitente;
            document.getElementById('viewRidDataOcorrencia').textContent = new Date(rid.dataOcorrencia).toLocaleDateString('pt-BR');
            document.getElementById('viewRidDataEmissao').textContent = new Date(rid.dataEmissao).toLocaleDateString('pt-BR');
            document.getElementById('viewRidTipoIncidente').textContent = rid.tipoIncidente;
            document.getElementById('viewRidLocalOcorrencia').textContent = rid.localOcorrencia;
            document.getElementById('viewRidDescricao').textContent = rid.descricao;
            document.getElementById('viewRidAcaoImediata').textContent = rid.acaoImediata;

            // Aplicar cores aos status e prioridade
            const statusElement = document.getElementById('viewRidStatus');
            const priorityElement = document.getElementById('viewRidPrioridade');
            
            statusElement.textContent = rid.status;
            priorityElement.textContent = rid.prioridade;
            
            // Cores para status
            statusElement.className = 'text-sm px-2 py-1 rounded-full inline-block';
            if (rid.status === 'Pendente') {
                statusElement.className += ' bg-red-100 text-red-800';
            } else if (rid.status === 'Em Andamento') {
                statusElement.className += ' bg-yellow-100 text-yellow-800';
            } else {
                statusElement.className += ' bg-green-100 text-green-800';
            }
            
            // Cores para prioridade
            priorityElement.className = 'text-sm px-2 py-1 rounded-full inline-block';
            if (rid.prioridade === 'Alta') {
                priorityElement.className += ' bg-red-100 text-red-800';
            } else if (rid.prioridade === 'M√©dia') {
                priorityElement.className += ' bg-yellow-100 text-yellow-800';
            } else {
                priorityElement.className += ' bg-green-100 text-green-800';
            }

            // Armazenar ID do RID atual para poss√≠vel edi√ß√£o
            currentRidId = ridId;
            
            // Mostrar modal
            document.getElementById('viewRidModal').classList.remove('hidden');
        }

        function closeViewRidModal() {
            document.getElementById('viewRidModal').classList.add('hidden');
            currentRidId = null;
        }

        function editRidFromView() {
            // Fechar modal de visualiza√ß√£o
            closeViewRidModal();
            
            // Abrir modal de edi√ß√£o com o RID atual
            if (currentRidId) {
                openEditRidModal(currentRidId);
            }
        }

        function editRid(ridId) {
            openEditRidModal(ridId);
        }

        function openEditRidModal(ridId) {
            const rid = rids.find(r => r.id === ridId);
            if (!rid) {
                showNotification('RID n√£o encontrado!', 'error');
                return;
            }

            // Preencher informa√ß√µes n√£o edit√°veis
            document.getElementById('editRidTitle').textContent = `Editar ${rid.numero}`;
            document.getElementById('editRidNumero').textContent = rid.numero;
            document.getElementById('editRidEmitente').textContent = rid.emitente;
            document.getElementById('editRidDataOcorrencia').textContent = new Date(rid.dataOcorrencia).toLocaleDateString('pt-BR');
            document.getElementById('editRidUnidade').textContent = rid.unidade;

            // Preencher campos edit√°veis
            document.getElementById('editRidStatus').value = rid.status;
            document.getElementById('editRidPrioridade').value = rid.prioridade;
            document.getElementById('editRidObservacoes').value = '';

            // Armazenar ID do RID sendo editado
            currentRidId = ridId;

            // Mostrar modal
            document.getElementById('editRidModal').classList.remove('hidden');
        }

        function closeEditRidModal() {
            document.getElementById('editRidModal').classList.add('hidden');
            document.getElementById('editRidForm').reset();
            currentRidId = null;
        }

        // Salvar edi√ß√£o do RID
        document.getElementById('editRidForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!currentRidId) {
                showNotification('Erro: RID n√£o identificado!', 'error');
                return;
            }

            const ridIndex = rids.findIndex(r => r.id === currentRidId);
            if (ridIndex === -1) {
                showNotification('RID n√£o encontrado!', 'error');
                return;
            }

            const newStatus = document.getElementById('editRidStatus').value;
            const newPrioridade = document.getElementById('editRidPrioridade').value;
            const observacoes = document.getElementById('editRidObservacoes').value;

            // Verificar se houve mudan√ßas
            const rid = rids[ridIndex];
            const statusChanged = rid.status !== newStatus;
            const prioridadeChanged = rid.prioridade !== newPrioridade;

            if (!statusChanged && !prioridadeChanged) {
                showNotification('Nenhuma altera√ß√£o foi feita!', 'warning');
                return;
            }

            // Atualizar RID
            rids[ridIndex].status = newStatus;
            rids[ridIndex].prioridade = newPrioridade;
            rids[ridIndex].dataUltimaEdicao = new Date().toISOString().split('T')[0];
            rids[ridIndex].editadoPor = currentUser.cpf;

            // Adicionar observa√ß√µes se fornecidas
            if (observacoes.trim()) {
                if (!rids[ridIndex].observacoesEdicao) {
                    rids[ridIndex].observacoesEdicao = [];
                }
                rids[ridIndex].observacoesEdicao.push({
                    data: new Date().toISOString().split('T')[0],
                    usuario: currentUser.name,
                    observacao: observacoes.trim(),
                    alteracoes: {
                        status: statusChanged ? { de: rid.status, para: newStatus } : null,
                        prioridade: prioridadeChanged ? { de: rid.prioridade, para: newPrioridade } : null
                    }
                });
            }

            // Salvar no servidor
            await saveDataToServer();
            
            closeEditRidModal();
            
            // Criar mensagem de sucesso detalhada
            let mensagem = 'RID atualizado com sucesso!';
            if (statusChanged && prioridadeChanged) {
                mensagem += ` Status: ${newStatus}, Prioridade: ${newPrioridade}`;
            } else if (statusChanged) {
                mensagem += ` Status alterado para: ${newStatus}`;
            } else if (prioridadeChanged) {
                mensagem += ` Prioridade alterada para: ${newPrioridade}`;
            }
            
            showNotification(mensagem, 'success');
            
            // Atualizar dashboards e tabelas
            if (currentUser.isAdmin) {
                updateAdminDashboard();
                loadRidsTable();
                loadAllRidsTable();
                updateTopEmployeesMonth();
            } else {
                updateEmployeeDashboard();
                loadEmployeeRidsTable();
            }
        });

        // Mostrar painel do funcion√°rio
        function showEmployeePanel() {
            // Esconder todas as telas
            loginScreen.classList.add('hidden');
            document.getElementById('adminPanel').classList.add('hidden');
            
            // Mostrar apenas o painel funcion√°rio
            document.getElementById('employeePanel').classList.remove('hidden');
            document.getElementById('employeeUserName').textContent = currentUser.name;
            
            // Atualizar dados do funcion√°rio
            updateEmployeeDashboard();
            loadEmployeeRidsTable();
        }

        function updateAdminDashboard() {
            const totalRids = rids.length;
            const pendingRids = rids.filter(r => r.status === 'Pendente').length;
            const inProgressRids = rids.filter(r => r.status === 'Em Andamento').length;
            const completedRids = rids.filter(r => r.status === 'Conclu√≠do').length;

            document.getElementById('totalRids').textContent = totalRids;
            document.getElementById('pendingRids').textContent = pendingRids;
            document.getElementById('inProgressRids').textContent = inProgressRids;
            document.getElementById('completedRids').textContent = completedRids;
        }

        function loadRidsTable() {
            // Filtrar RIDs da semana atual (domingo 20/10/25 at√© hoje 26/10/25)
            const startOfWeek = new Date('2025-10-20'); // Domingo 20/10/25
            const today = new Date('2025-10-26'); // Hoje √© 26/10/25
            today.setHours(23, 59, 59, 999); // Incluir todo o dia de hoje
            
            const weekRids = rids.filter(rid => {
                const ridDate = new Date(rid.dataOcorrencia);
                return ridDate >= startOfWeek && ridDate <= today;
            }).reverse(); // Mais recentes primeiro
            
            const tbody = document.getElementById('ridsTableBody');
            tbody.innerHTML = weekRids.map(rid => {
                const user = users.find(u => u.cpf === rid.emitenteCpf);
                const statusColor = rid.status === 'Pendente' ? 'bg-red-100 text-red-800' : 
                                  rid.status === 'Em Andamento' ? 'bg-yellow-100 text-yellow-800' : 
                                  'bg-green-100 text-green-800';
                const priorityColor = rid.prioridade === 'Alta' ? 'bg-red-100 text-red-800' : 
                                    rid.prioridade === 'M√©dia' ? 'bg-yellow-100 text-yellow-800' : 
                                    'bg-green-100 text-green-800';

                return `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-dark">${rid.numero}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${user ? user.name : 'N/A'}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${new Date(rid.dataOcorrencia).toLocaleDateString('pt-BR')}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusColor}">
                                ${rid.status}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${priorityColor}">
                                ${rid.prioridade}
                            </span>
                        </td>
                    </tr>
                `;
            }).join('');
        }



        function updateEmployeeDashboard() {
            const myRids = rids.filter(r => r.emitenteCpf === currentUser.cpf);
            const myTotal = myRids.length;
            const myPending = myRids.filter(r => r.status === 'Pendente').length;
            const myInProgress = myRids.filter(r => r.status === 'Em Andamento').length;
            const myCompleted = myRids.filter(r => r.status === 'Conclu√≠do').length;

            document.getElementById('myTotalRids').textContent = myTotal;
            document.getElementById('myPendingRids').textContent = myPending;
            document.getElementById('myInProgressRids').textContent = myInProgress;
            document.getElementById('myCompletedRids').textContent = myCompleted;
        }

        function loadEmployeeRidsTable() {
            const myRids = rids.filter(r => r.emitenteCpf === currentUser.cpf);
            const tbody = document.getElementById('employeeRidsTableBody');
            
            tbody.innerHTML = myRids.map(rid => {
                const statusColor = rid.status === 'Pendente' ? 'bg-red-100 text-red-800' : 
                                  rid.status === 'Em Andamento' ? 'bg-yellow-100 text-yellow-800' : 
                                  'bg-green-100 text-green-800';
                const priorityColor = rid.prioridade === 'Alta' ? 'bg-red-100 text-red-800' : 
                                    rid.prioridade === 'M√©dia' ? 'bg-yellow-100 text-yellow-800' : 
                                    'bg-green-100 text-green-800';

                return `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-dark">${rid.numero}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${new Date(rid.dataOcorrencia).toLocaleDateString('pt-BR')}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${rid.localOcorrencia}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusColor}">
                                ${rid.status}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${priorityColor}">
                                ${rid.prioridade}
                            </span>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Modal de RID
        function openRidModal() {
            document.getElementById('ridModal').classList.remove('hidden');
            
            // Preencher dados do usu√°rio atual
            if (currentUser) {
                document.getElementById('ridEmitente').value = currentUser.name;
                document.getElementById('ridSetorEmitente').value = currentUser.sector;
            }
            
            // Definir data atual
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('ridDataOcorrencia').value = today;
        }

        function closeRidModal() {
            document.getElementById('ridModal').classList.add('hidden');
            document.getElementById('ridForm').reset();
        }

        // Salvar RID
        document.getElementById('ridForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const ridData = {
                emitente: document.getElementById('ridEmitente').value,
                tipoContrato: document.getElementById('ridTipoContrato').value,
                unidade: document.getElementById('ridUnidade').value,
                setorEmitente: document.getElementById('ridSetorEmitente').value,
                dataOcorrencia: document.getElementById('ridDataOcorrencia').value,
                tipoIncidente: document.getElementById('ridTipoIncidente').value,
                localOcorrencia: document.getElementById('ridLocalOcorrencia').value,
                descricao: document.getElementById('ridDescricao').value,
                acaoImediata: document.getElementById('ridAcaoImediata').value,
                prioridade: document.getElementById('ridPrioridade').value,
                status: document.getElementById('ridStatus').value,
                emitenteCpf: currentUser.cpf,
                dataEmissao: new Date().toISOString().split('T')[0]
            };

            ridCounter++;
            const newRid = {
                id: Date.now().toString(),
                numero: `RID-${ridCounter.toString().padStart(4, '0')}`,
                ...ridData
            };
            
            rids.push(newRid);
            
            // Salvar no servidor online
            await saveDataToServer();
            
            closeRidModal();
            
            showNotification('RID criado e sincronizado com sucesso!', 'success');
            
            // Atualizar dashboards e tabelas
            if (currentUser.isAdmin) {
                updateAdminDashboard();
                loadRidsTable();
                updateTopEmployeesMonth();
            } else {
                updateEmployeeDashboard();
                loadEmployeeRidsTable();
            }
        });

        // Logout
        function logout() {
            currentUser = null;
            loginScreen.classList.remove('hidden');
            document.getElementById('adminPanel').classList.add('hidden');
            document.getElementById('employeePanel').classList.add('hidden');
            loginForm.reset();
            registerForm.reset();
        }

        // Fun√ß√µes de gerenciamento de tarefas
        function loadTasksTable() {
            const tbody = document.getElementById('tasksTableBody');
            const filteredTasks = filterTasksByStatus();
            
            tbody.innerHTML = filteredTasks.map(task => {
                const statusColor = task.status === 'Pendente' ? 'bg-red-100 text-red-800' : 
                                  task.status === 'Em Andamento' ? 'bg-yellow-100 text-yellow-800' : 
                                  'bg-green-100 text-green-800';
                const priorityColor = task.priority === 'Alta' ? 'bg-red-100 text-red-800' : 
                                    task.priority === 'M√©dia' ? 'bg-yellow-100 text-yellow-800' : 
                                    'bg-green-100 text-green-800';
                
                const isOverdue = new Date(task.dueDate) < new Date() && task.status !== 'Conclu√≠da';
                const dueDateClass = isOverdue ? 'text-red-600 font-medium' : 'text-gray-900';

                return `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-dark">${task.title}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${priorityColor}">
                                ${task.priority}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusColor}">
                                ${task.status}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm ${dueDateClass}">
                            ${new Date(task.dueDate).toLocaleDateString('pt-BR')}
                            ${isOverdue ? ' (Atrasada)' : ''}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            <button class="text-blue-600 hover:text-blue-800 mr-2" onclick="editTask('${task.id}')">Editar</button>
                            <button class="text-red-600 hover:text-red-800" onclick="deleteTask('${task.id}')">Excluir</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function filterTasksByStatus() {
            const filter = document.getElementById('taskFilter').value;
            if (filter === 'all') {
                return tasks;
            }
            return tasks.filter(task => task.status === filter);
        }

        function filterTasks() {
            loadTasksTable();
        }

        function editTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) {
                showNotification('Tarefa n√£o encontrada!', 'error');
                return;
            }

            // Criar modal inline para edi√ß√£o r√°pida de status
            const newStatus = task.status === 'Pendente' ? 'Em Andamento' : 
                             task.status === 'Em Andamento' ? 'Conclu√≠da' : 'Pendente';
            
            const confirmMessage = `Alterar status da tarefa "${task.title}" para "${newStatus}"?`;
            
            if (confirm(confirmMessage)) {
                const taskIndex = tasks.findIndex(t => t.id === taskId);
                tasks[taskIndex].status = newStatus;
                
                if (newStatus === 'Conclu√≠da') {
                    tasks[taskIndex].completedAt = new Date().toISOString().split('T')[0];
                }
                
                saveDataToServer();
                loadTasksTable();
                showNotification(`Status da tarefa alterado para "${newStatus}"!`, 'success');
            }
        }

        async function deleteTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) {
                showNotification('Tarefa n√£o encontrada!', 'error');
                return;
            }

            if (confirm(`Tem certeza que deseja excluir a tarefa "${task.title}"?`)) {
                tasks = tasks.filter(t => t.id !== taskId);
                await saveDataToServer();
                loadTasksTable();
                showNotification('Tarefa exclu√≠da com sucesso!', 'success');
            }
        }

        // Inicializar sistema quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', function() {
            initSystem();
        });
        
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'994d6230747b1433',t:'MTc2MTUxNzY3My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
